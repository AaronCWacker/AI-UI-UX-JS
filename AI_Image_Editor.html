<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Tag Editor Game</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 20px; }
    #canvas { border: 1px solid #000; }
    #editor { margin-top: 20px; }
    .emoji-btn { font-size: 24px; margin: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Image Tag Editor Game</h1>
  <div id="canvas"></div>
  <div id="editor">
    <h3>Edit Metadata</h3>
    <label>Camera Model: <input type="text" id="cameraModel"></label><br>
    <label>Date Taken: <input type="text" id="dateTaken"></label><br>
    <label>GPS Coordinates: <input type="text" id="gpsCoords"></label><br>
    <label>ICC Profile Note: <input type="text" id="iccProfile"></label><br>
    <button onclick="suggestTags()">Suggest Cool Tags!</button>
    <div id="emojiButtons"></div>
    <button onclick="saveMetadata()">Save & Download</button>
  </div>

  <script>
    let img;
    let canvas;

    function setup() {
      canvas = createCanvas(400, 300);
      canvas.parent('canvas');
      img = null;
      // Handle paste event
      document.addEventListener('paste', handlePaste);
    }

    function draw() {
      background(220);
      if (img) {
        image(img, 0, 0, width, height);
        // Display tags as overlay
        let tags = getTags();
        fill(255);
        textSize(12);
        text(tags, 10, 20);
      }
    }

    function handlePaste(e) {
      if (e.clipboardData && e.clipboardData.items) {
        let item = e.clipboardData.items[0];
        if (item.type.indexOf('image') === 0) {
          let blob = item.getAsFile();
          img = createImg(URL.createObjectURL(blob), 'Uploaded Image', () => {
            loadImage(URL.createObjectURL(blob), loadedImg => {
              img = loadedImg;
              extractMetadata(blob);
            });
          }, 'anonymous');
        }
      }
    }

    function extractMetadata(file) {
      EXIF.getData(file, function() {
        document.getElementById('cameraModel').value = EXIF.getTag(this, 'Model') || '';
        document.getElementById('dateTaken').value = EXIF.getTag(this, 'DateTimeOriginal') || '';
        document.getElementById('gpsCoords').value = EXIF.getTag(this, 'GPSLatitude') && EXIF.getTag(this, 'GPSLongitude') 
          ? `${EXIF.getTag(this, 'GPSLatitude')}, ${EXIF.getTag(this, 'GPSLongitude')}` : '';
        document.getElementById('iccProfile').value = 'Color profile data (edit manually)';
      });
    }

    function suggestTags() {
      const emojis = [
        { text: 'ðŸŒŸ I Like!', value: 'liked' },
        { text: 'ðŸŒŠ Cool Scene!', value: 'scenic' },
        { text: 'ðŸš¢ Boat Vibes!', value: 'boat' },
        { text: 'ðŸŒ™ Night Mood!', value: 'night' }
      ];
      let buttons = document.getElementById('emojiButtons');
      buttons.innerHTML = '';
      emojis.forEach(emoji => {
        let btn = document.createElement('button');
        btn.className = 'emoji-btn';
        btn.innerHTML = emoji.text;
        btn.onclick = () => addTag(emoji.value);
        buttons.appendChild(btn);
      });
    }

    function addTag(tag) {
      let inputs = [document.getElementById('cameraModel'), document.getElementById('dateTaken'), 
                    document.getElementById('gpsCoords'), document.getElementById('iccProfile')];
      inputs.forEach(input => {
        if (input.value) input.value += ` #${tag}`;
      });
    }

    function getTags() {
      let tags = '';
      let inputs = ['cameraModel', 'dateTaken', 'gpsCoords', 'iccProfile'];
      inputs.forEach(id => {
        let value = document.getElementById(id).value.trim();
        if (value) tags += `${value} `;
      });
      return tags || 'No tags added';
    }

    function saveMetadata() {
      if (img) {
        let tags = getTags();
        // Create a new canvas with the image and tags
        let tempCanvas = createGraphics(400, 300);
        tempCanvas.image(img, 0, 0, 400, 300);
        tempCanvas.fill(255);
        tempCanvas.textSize(12);
        tempCanvas.text(tags, 10, 20);

        // Convert to downloadable image
        tempCanvas.canvas.toBlob(function(blob) {
          let a = document.createElement('a');
          let url = URL.createObjectURL(blob);
          a.href = url;
          a.download = 'tagged_image.png';
          a.click();
          URL.revokeObjectURL(url);
        }, 'image/png');
      } else {
        alert('Please paste an image first!');
      }
    }
  </script>
</body>
</html>

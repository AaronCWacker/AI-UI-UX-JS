<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Forge: Metals & Magnetism Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,700&family=Crimson+Text:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <style>
        /* --- Steel & Metal Theming --- */
        :root {
            --bg-color: #1a1a1a;
            --card-bg: #f5f5f0;
            --card-border: #c0c0c0;
            --primary-text: #e0e0e0;
            --secondary-text: #2a2a2a;
            --accent-color: #b87333; /* Bronze */
            --steel-color: #708090; /* Steel Blue */
            --iron-color: #8b4513; /* Iron Brown */
            --powerup-color: #00ffcc; /* Cyan for Tech/Powerups */
            --shadow-color: rgba(0, 0, 0, 0.6);
            --card-back-bg: linear-gradient(145deg, #708090, #2f4f4f);
        }

        body {
            font-family: 'Crimson Text', serif;
            background-color: var(--bg-color);
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(184, 115, 51, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(112, 128, 144, 0.1) 0%, transparent 50%),
                linear-gradient(45deg, transparent 48%, rgba(139, 69, 19, 0.03) 50%, transparent 52%);
            color: var(--primary-text);
            margin: 0;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            overflow-x: hidden;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-style: italic;
            color: var(--accent-color);
            text-shadow: 2px 2px 5px var(--shadow-color);
            margin-bottom: 0.5rem;
            font-size: 2.2rem;
        }

        /* --- Game HUD --- */
        #game-hud {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin-bottom: 1rem;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--steel-color);
            border-radius: 10px;
            box-sizing: border-box;
        }

        .hud-stat {
            display: flex;
            flex-direction: column;
        }

        .hud-label {
            font-size: 0.8rem;
            color: var(--steel-color);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hud-value {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--primary-text);
        }

        #active-powerups {
            color: var(--powerup-color);
            text-shadow: 0 0 5px var(--powerup-color);
        }

        /* --- Challenge Banner --- */
        #challenge-banner {
            background: linear-gradient(90deg, transparent, rgba(184, 115, 51, 0.2), transparent);
            width: 100%;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        #challenge-text {
            font-size: 1.4rem;
            font-style: italic;
            color: #fff;
        }

        .highlight-word {
            color: var(--accent-color);
            font-weight: bold;
            font-family: 'Playfair Display', serif;
        }

        /* --- Controls --- */
        #controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        button {
            font-family: 'Playfair Display', serif;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            border: 2px solid var(--accent-color);
            background-color: transparent;
            color: var(--accent-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(184, 115, 51, 0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover:not(:disabled) {
            background-color: var(--accent-color);
            color: var(--secondary-text);
            box-shadow: 0 4px 20px rgba(184, 115, 51, 0.4);
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: var(--steel-color);
            color: var(--steel-color);
        }

        /* --- Card Area --- */
        #card-slots {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            perspective: 1200px;
            width: 100%;
            max-width: 1000px;
            min-height: 400px;
        }

        .card-slot {
            width: 260px;
            height: 400px;
            position: relative;
        }
        
        .card {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card.is-flipped {
            transform: rotateY(180deg);
        }

        .card.correct-answer {
            box-shadow: 0 0 20px 5px var(--powerup-color);
        }

        .card.wrong-answer {
            box-shadow: 0 0 20px 5px #ff4444;
            opacity: 0.6;
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            box-shadow: 0 10px 25px var(--shadow-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .card-back {
            background: var(--card-back-bg);
            border: 5px solid var(--accent-color);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .card-back-design {
            font-size: 3rem;
            color: var(--accent-color);
            opacity: 0.8;
            border: 2px solid var(--accent-color);
            width: 80%;
            height: 90%;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .card-front {
            background-color: var(--card-bg);
            color: var(--secondary-text);
            transform: rotateY(180deg);
            padding: 1rem;
            text-align: left;
            overflow-y: auto;
            border: 2px solid var(--card-border);
        }

        .card-header {
            text-align: center;
            border-bottom: 2px solid var(--card-border);
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .card-header h2 {
            margin: 0;
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            color: var(--iron-color);
        }

        .powerup-badge {
            display: none;
            background: var(--powerup-color);
            color: #000;
            padding: 5px;
            margin-top: 5px;
            border-radius: 5px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.8rem;
            animation: pulse 1s infinite;
        }

        .correct-answer .powerup-badge {
            display: inline-block;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* --- Footer/Log --- */
        #game-log {
            margin-top: 2rem;
            color: var(--steel-color);
            font-style: italic;
            max-width: 600px;
        }

    </style>
</head>
<body>

    <h1>The Forge: Metals & Magnetism</h1>
    
    <div id="game-hud">
        <div class="hud-stat">
            <span class="hud-label">Resonance Score</span>
            <span class="hud-value" id="score-display">0</span>
        </div>
        <div class="hud-stat">
            <span class="hud-label">Current Streak</span>
            <span class="hud-value" id="streak-display">0</span>
        </div>
        <div class="hud-stat">
            <span class="hud-label">Active Powerup</span>
            <span class="hud-value" id="active-powerups">None</span>
        </div>
    </div>

    <div id="challenge-banner">
        <p id="challenge-text">Initialize the Forge to begin...</p>
    </div>

    <div id="controls">
        <button id="start-btn">Initialize Forge</button>
        <button id="next-btn" disabled>Next Flux</button>
    </div>

    <div id="card-slots">
        </div>

    <div id="game-log"></div>

    <script>
        // --- Full Tarot Data ---
        const tarot_data = [
            // Major Arcana (Theme: Heritage & Vision)
            {"name":"The Wacker Legacy","card":"0 - The Fool","classifier":"Major Arcana","tags":["heritage","vision"],"powerup":"Ancestral Sight","emojis":"üèóÔ∏è, üå≤","heritage":"Charles Wacker's vision transforms from the Black Forest to Chicago.","science":"Technological leaps require bold vision."},
            {"name":"The Master Metallurgist","card":"I - The Magician","classifier":"Major Arcana","tags":["heritage","craft"],"powerup":"CNC Precision","emojis":"üî®, ‚ö°","heritage":"Your father inventing deep-water drilling techniques.","science":"Modern metallurgy combines ancient wisdom with quantum precision."},
            {"name":"The Hidden Magnetism","card":"II - The High Priestess","classifier":"Major Arcana","tags":["magnetism","mystery"],"powerup":"Intuition Boost","emojis":"üì±, üß≤","heritage":"Coins revealing invisible magnetic fields.","science":"Ferromagnetism operates through quantum exchange interactions."},
            {"name":"Industrial Abundance","card":"III - The Empress","classifier":"Major Arcana","tags":["industry","production"],"powerup":"Mass Production","emojis":"üè≠, üöõ","heritage":"Parts for Caterpillar and Corvette flowing from the presses.","science":"Manufacturing transforms raw metals through controlled deformation."},
            {"name":"The Engineering Authority","card":"IV - The Emperor","classifier":"Major Arcana","tags":["tech","control"],"powerup":"Structure Lock","emojis":"üìê, ‚öôÔ∏è","heritage":"G-code commands governing physical reality.","science":"Computer numerical control (CNC) executes binary logic."},
            
            // Swords (Theme: Metals & Properties)
            {"name":"Pure Iron Truth","card":"Ace of Swords","classifier":"Swords","tags":["metal","magnetic"],"powerup":"Ferrous Core","emojis":"‚öîÔ∏è, üß≤","heritage":"Iron as the foundation of the modern world.","science":"Iron atoms have unpaired electrons creating magnetic dipoles."},
            {"name":"Nickel's Duality","card":"Two of Swords","classifier":"Swords","tags":["metal","magnetic"],"powerup":"Alloy Choice","emojis":"ü§î, ‚öñÔ∏è","heritage":"The choice between pure nickel and alloys.","science":"Pure nickel is ferromagnetic; alloys vary."},
            {"name":"Cobalt's Strength","card":"Three of Swords","classifier":"Swords","tags":["metal","magnetic"],"powerup":"High Temp Shield","emojis":"üíî, üíô","heritage":"Toxic, rare, but essential for strong magnets.","science":"Cobalt has the highest Curie temperature."},
            {"name":"Aluminum's Defeat","card":"Five of Swords","classifier":"Swords","tags":["metal","non-magnetic"],"powerup":"Lightweight","emojis":"üòî, ‚ö°","heritage":"Lightweight but magnetically weak.","science":"Aluminum is paramagnetic (weak response)."},
            {"name":"Copper's Journey","card":"Six of Swords","classifier":"Swords","tags":["metal","conductive"],"powerup":"Conductivity","emojis":"üö§, üî¥","heritage":"From ancient tools to modern electricity.","science":"Copper is diamagnetic and highly conductive."},
            {"name":"Neodymium's Quest","card":"Knight of Swords","classifier":"Swords","tags":["metal","magnetic","strong"],"powerup":"Super Strength","emojis":"üèá, üß≤","heritage":"The pursuit of maximum magnetic strength.","science":"Neodymium magnets have the highest magnetic energy product."},

            // Wands (Theme: Tech Devices)
            {"name":"iPhone MagSafe","card":"Two of Wands","classifier":"Wands","tags":["tech","device"],"powerup":"Alignment","emojis":"üì±, ‚öñÔ∏è","heritage":"Precision-aligned rare earth magnets.","science":"18 magnets arranged in a circle for perfect charging alignment."},
            {"name":"GPU Thermal Victory","card":"Six of Wands","classifier":"Wands","tags":["tech","cooling"],"powerup":"Cooling Flow","emojis":"üñ•Ô∏è, üèÜ","heritage":"Magnetic bearing fans for silent cooling.","science":"Magnetic levitation eliminates friction in fans."},
            {"name":"Wireless Power Queen","card":"Queen of Wands","classifier":"Wands","tags":["tech","power"],"powerup":"Induction","emojis":"üëë, üîã","heritage":"Energy transfer without physical connection.","science":"Induction relies on alternating magnetic fields."},

            // Cups (Theme: Global Economy/Coins)
            {"name":"US Dollar Foundation","card":"Ace of Cups","classifier":"Cups","tags":["economy","coin"],"powerup":"Reserve Currency","emojis":"üíµ, üÜï","heritage":"USD as the world's reserve currency.","science":"Steel pennies (1943) are the only magnetic US cents."},
            {"name":"European Unity","card":"Three of Cups","classifier":"Cups","tags":["economy","coin"],"powerup":"Bimetallic","emojis":"üí∂, üéâ","heritage":"Nations sharing one currency.","science":"Euro coins often have magnetic rings and non-magnetic centers."},
            {"name":"Canadian Generosity","card":"Six of Cups","classifier":"Cups","tags":["economy","coin","magnetic"],"powerup":"Steel Core","emojis":"üçÅ, üéÅ","heritage":"Canadian coins are multi-ply plated steel.","science":"Canadian coins are strongly magnetic due to steel cores."},

            // Pentacles (Theme: Superconductors)
            {"name":"Room Temp Dream","card":"Ace of Pentacles","classifier":"Pentacles","tags":["future","superconductor"],"powerup":"Zero Resistance","emojis":"üíé, üå°Ô∏è","heritage":"The holy grail of perfect electrical flow.","science":"Eliminating resistance would revolutionize power grids."},
            {"name":"Flux Pinning","card":"Four of Pentacles","classifier":"Pentacles","tags":["future","levitation"],"powerup":"Levitation","emojis":"üîí, ü™ô","heritage":"Stability that defies gravity.","science":"Magnetic flux lines become trapped at crystal defects."},
            {"name":"MRI Legacy","card":"Ten of Pentacles","classifier":"Pentacles","tags":["future","medical"],"powerup":"Deep Scan","emojis":"üè•, üß≤","heritage":"Seeing inside without cutting.","science":"Superconducting magnets align nuclear spins."}
        ];

        // --- Game State ---
        let score = 0;
        let streak = 0;
        let currentChallenge = null;
        let activePowerupEffect = null;
        let roundActive = false;
        let correctAnswerIndex = -1;

        // --- DOM Elements ---
        const startBtn = document.getElementById('start-btn');
        const nextBtn = document.getElementById('next-btn');
        const slotsContainer = document.getElementById('card-slots');
        const challengeText = document.getElementById('challenge-text');
        const scoreDisplay = document.getElementById('score-display');
        const streakDisplay = document.getElementById('streak-display');
        const powerupDisplay = document.getElementById('active-powerups');
        const log = document.getElementById('game-log');

        // --- Logic ---

        function updateHUD() {
            scoreDisplay.textContent = score;
            streakDisplay.textContent = streak;
            
            if(streak > 2) {
                powerupDisplay.textContent = "FLUX AMPLIFIED (2x Score)";
                powerupDisplay.style.color = "#ffaa00";
            } else {
                powerupDisplay.textContent = "None";
                powerupDisplay.style.color = "var(--powerup-color)";
            }
        }

        function generateChallenge() {
            // Define possible challenge types based on tags
            const types = [
                { text: "Find a source of <span class='highlight-word'>Ferromagnetism</span> (Strongly Magnetic)", tag: "magnetic", exclude: "non-magnetic" },
                { text: "Identify a <span class='highlight-word'>Heritage</span> connection to the past.", tag: "heritage", exclude: null },
                { text: "Locate a device using <span class='highlight-word'>Modern Tech</span> magnetism.", tag: "tech", exclude: null },
                { text: "Find a <span class='highlight-word'>Global Economy</span> currency.", tag: "economy", exclude: null },
                { text: "Discover a <span class='highlight-word'>Superconducting</span> Future.", tag: "future", exclude: null },
                { text: "Find the <span class='highlight-word'>Non-Magnetic</span> material.", tag: "non-magnetic", exclude: "magnetic" }
            ];

            const type = types[Math.floor(Math.random() * types.length)];
            
            // Filter cards
            let correctCards = tarot_data.filter(c => c.tags.includes(type.tag));
            let wrongCards = tarot_data.filter(c => !c.tags.includes(type.tag));

            if (type.exclude) {
                // strict exclusion
                 correctCards = correctCards.filter(c => !c.tags.includes(type.exclude));
            }

            // Pick 1 Correct
            const winner = correctCards[Math.floor(Math.random() * correctCards.length)];
            
            // Pick 2 Wrong
            const shuffleArray = (arr) => arr.sort(() => 0.5 - Math.random());
            const losers = shuffleArray(wrongCards).slice(0, 2);

            return {
                prompt: type.text,
                cards: shuffleArray([winner, ...losers]),
                winnerId: winner.name // Identify by name
            };
        }

        function createCardHTML(cardData, index, isWinner) {
            const div = document.createElement('div');
            div.className = 'card-slot';
            div.innerHTML = `
                <div class="card" id="card-${index}" onclick="handleCardClick(${index}, '${cardData.name.replace(/'/g, "\\'")}')">
                    <div class="card-face card-back">
                        <div class="card-back-design">‚öôÔ∏è</div>
                    </div>
                    <div class="card-face card-front">
                        <div class="card-header">
                            <h2>${cardData.name} ${cardData.emojis}</h2>
                            <div class="powerup-badge">POWERUP: ${cardData.powerup}</div>
                        </div>
                        <p style="font-size: 0.9rem; font-style: italic;">${cardData.heritage}</p>
                        <p style="font-size: 0.85rem; border-top: 1px solid #ccc; padding-top: 5px;"><strong>Science:</strong> ${cardData.science}</p>
                    </div>
                </div>
            `;
            return div;
        }

        function startRound() {
            roundActive = true;
            nextBtn.disabled = true;
            startBtn.disabled = true;
            slotsContainer.innerHTML = '';
            log.textContent = '';

            // Generate Logic
            currentChallenge = generateChallenge();
            
            // Set UI
            challengeText.innerHTML = currentChallenge.prompt;

            // Render Cards
            currentChallenge.cards.forEach((card, index) => {
                slotsContainer.appendChild(createCardHTML(card, index));
            });
        }

        window.handleCardClick = function(index, cardName) {
            if (!roundActive) return;

            const cardEl = document.getElementById(`card-${index}`);
            const isCorrect = (cardName === currentChallenge.winnerId);
            const allCards = document.querySelectorAll('.card');

            // Flip all cards to reveal
            allCards.forEach(c => c.classList.add('is-flipped'));
            roundActive = false;

            if (isCorrect) {
                // WIN LOGIC
                cardEl.classList.add('correct-answer');
                let points = 100;
                
                // Streak Multiplier
                if (streak > 2) points *= 2;
                
                score += points;
                streak++;
                
                const cardData = currentChallenge.cards.find(c => c.name === cardName);
                log.textContent = `Excellent! You uncovered ${cardData.powerup}.`;
                
            } else {
                // LOSE LOGIC
                cardEl.classList.add('wrong-answer');
                
                // Highlight the correct one
                currentChallenge.cards.forEach((c, i) => {
                    if (c.name === currentChallenge.winnerId) {
                        document.getElementById(`card-${i}`).classList.add('correct-answer');
                    }
                });

                streak = 0;
                log.textContent = "Flux disturbance detected. Alignment failed.";
            }

            updateHUD();
            nextBtn.disabled = false;
            
            if(score >= 1000) {
                challengeText.innerHTML = "MASTER METALLURGIST STATUS ACHIEVED!";
                challengeText.style.color = "#00ffcc";
            }
        };

        startBtn.addEventListener('click', () => {
            score = 0;
            streak = 0;
            updateHUD();
            startBtn.style.display = 'none'; // Hide start button after first press
            startRound();
        });

        nextBtn.addEventListener('click', startRound);

    </script>
</body>
</html>

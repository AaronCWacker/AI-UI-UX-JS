<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cerebral Intuition - Neural Biodome</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            overflow: hidden;
            background: #000;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        #canvas { display: block; }
       
        #ui {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
        }
       
        #title {
            font-size: 2.5em;
            font-weight: 300;
            letter-spacing: 8px;
            margin-bottom: 5px;
            background: linear-gradient(90deg, #00ffff, #ff00ff, #00ffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 3s infinite;
        }
       
        @keyframes shimmer {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(30deg); }
        }
       
        #subtitle {
            font-size: 0.9em;
            letter-spacing: 4px;
            opacity: 0.7;
        }
       
        #stats {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: #00ffff;
            font-size: 0.8em;
            opacity: 0.6;
        }
       
        #controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: #00ffff;
            font-size: 0.75em;
            text-align: right;
            opacity: 0.5;
        }
       
        #neural-activity {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 200px;
            padding: 15px;
            background: rgba(0, 20, 40, 0.7);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            color: #00ffff;
            font-size: 0.8em;
        }
       
        #neural-activity h3 {
            margin-bottom: 10px;
            font-weight: 300;
            letter-spacing: 2px;
        }
       
        .activity-bar {
            height: 4px;
            background: rgba(0, 255, 255, 0.2);
            margin: 8px 0;
            border-radius: 2px;
            overflow: hidden;
        }
       
        .activity-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            border-radius: 2px;
            transition: width 0.3s;
        }
       
        .activity-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* New scene controls styles */
        #scene-controls {
            position: fixed;
            top: 80px;
            left: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .scene-btn {
            background: rgba(0, 20, 40, 0.7);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 5px;
            color: #00ffff;
            padding: 8px 16px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
            text-shadow: 0 0 5px #00ffff;
        }

        .scene-btn:hover {
            background: rgba(0, 40, 80, 0.7);
            transform: scale(1.05);
        }

        #file-input {
            display: none;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div id="title">CEREBRAL INTUITION</div>
        <div id="subtitle">NEURAL BIODOME COLONY • TITAN ORBIT</div>
    </div>
   
    <div id="neural-activity">
        <h3>⚡ NEURAL ACTIVITY</h3>
        <div class="activity-label"><span>Synaptic Flow</span><span id="syn-val">0%</span></div>
        <div class="activity-bar"><div class="activity-fill" id="syn-bar" style="width: 0%"></div></div>
        <div class="activity-label"><span>Consciousness Net</span><span id="con-val">0%</span></div>
        <div class="activity-bar"><div class="activity-fill" id="con-bar" style="width: 0%"></div></div>
        <div class="activity-label"><span>Intuition Matrix</span><span id="int-val">0%</span></div>
        <div class="activity-bar"><div class="activity-fill" id="int-bar" style="width: 0%"></div></div>
        <div class="activity-label"><span>Drone Swarm</span><span id="drone-val">0%</span></div>
        <div class="activity-bar"><div class="activity-fill" id="drone-bar" style="width: 0%"></div></div>
    </div>
   
    <div id="stats">
        <div>Population: 12,847 minds</div>
        <div>Drones Active: <span id="drone-count">0</span></div>
        <div>Neural Sync: <span id="sync-rate">0</span>%</div>
    </div>
   
    <div id="controls">
        Drag to orbit • Scroll to zoom<br>
        Click domes to highlight
    </div>

    <!-- New scene controls -->
    <div id="scene-controls">
        <button class="scene-btn" id="new-btn">New Scene</button>
        <button class="scene-btn" id="save-btn">Save Scene</button>
        <button class="scene-btn" id="open-btn">Open Scene</button>
        <input type="file" id="file-input" accept=".md">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Embedded default Markdown for initial/"New" state generation
        const defaultMarkdown = `
# Neural Biodome Configuration Recipe

## Overview

This is the default recipe embedded in the app for initial world generation. Edit externally for custom loads.

## Global Parameters

| Key | Value | Description |
|-----|-------|-------------|
| time | 0.000 | Simulation time (usually leave as-is) |
| camera_theta | 0.000 | Camera horizontal angle |
| camera_phi | 1.047 | Camera vertical angle |
| camera_radius | 30.000 | Camera distance |
| brain_scale | 1.200 | Scale of the central brain structure |
| population | 12847 | Displayed population count |
| synapse_count | 500 | Number of synaptic particles (edit for density) |
| drone_count | 15 | Number of drones to generate |
| drone_min_orbit_radius | 5 | Min orbit radius for random generation |
| drone_max_orbit_radius | 12 | Max orbit radius for random generation |
| drone_min_orbit_height | 3 | Min orbit height |
| drone_max_orbit_height | 9 | Max orbit height |
| drone_min_orbit_speed | 0.2 | Min orbit speed |
| drone_max_orbit_speed | 0.5 | Max orbit speed |
| drone_min_bob_speed | 1 | Min bob speed |
| drone_max_bob_speed | 3 | Max bob speed |
| drone_min_bob_amount | 0.1 | Min bob amount |
| drone_max_bob_amount | 0.3 | Max bob amount |
| drone_lsystem_axiom | F | Starting symbol for drone L-System growth |
| drone_lsystem_rules | {"F":"F[+F]F[-F]F"} | Rules for L-System expansion (JSON object) |
| drone_lsystem_iterations | 3 | Number of growth iterations (higher = more complex) |
| drone_lsystem_angle | 25 | Base branch angle in degrees |
| drone_lsystem_angle_variation | 10 | Random variation in angle (± degrees) |
| drone_lsystem_length | 0.2 | Base branch length |
| drone_lsystem_length_variation | 0.1 | Random variation in length (±) |
| dome_count | 8 | Number of small domes to generate |
| dome_min_x | -7 | Min X position for random dome placement |
| dome_max_x | 7 | Max X position |
| dome_min_z | -7 | Min Z position |
| dome_max_z | 7 | Max Z position |
| dome_min_scale | 0.5 | Min scale for domes |
| dome_max_scale | 0.8 | Max scale for domes |
| dome_lsystem_axiom | F | Starting symbol for dome L-System growth |
| dome_lsystem_rules | {"F":"F[+F][-F]"} | Rules for L-System expansion (JSON object) |
| dome_lsystem_iterations | 2 | Number of growth iterations |
| dome_lsystem_angle | 30 | Base branch angle |
| dome_lsystem_angle_variation | 5 | Random variation in angle |
| dome_lsystem_length | 1 | Base branch length |
| dome_lsystem_length_variation | 0.2 | Random variation in length |

## Drones

| id | orbitRadius | orbitHeight | orbitSpeed | orbitPhase | bobSpeed | bobAmount | currentX | currentY | currentZ | lsystemAngle | lsystemLength |
|----|-------------|-------------|------------|------------|----------|-----------|----------|----------|----------|--------------|---------------|
| 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 25 | 0.2 |

## Small Domes

| id | posX | posZ | scale | pulsePhase | lsystemAngle | lsystemLength |
|----|------|------|-------|------------|--------------|---------------|
| 0 | 0 | 0 | 0.5 | 0 | 30 | 1 |
        `;

        // Parse default Markdown to set initial config
        const defaultData = parseMarkdown(defaultMarkdown);
        let config = defaultData.globals || {};

        // Scene setup and rest of the code...

        // At the end, call resetScene() to generate initial world from default Markdown
        resetScene();
    </script>
</body>
</html>

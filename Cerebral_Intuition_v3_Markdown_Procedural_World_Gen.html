<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cerebral Intuition - Neural Biodome</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            overflow: hidden;
            background: #000;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        #canvas { display: block; }
       
        #ui {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
        }
       
        #title {
            font-size: 2.5em;
            font-weight: 300;
            letter-spacing: 8px;
            margin-bottom: 5px;
            background: linear-gradient(90deg, #00ffff, #ff00ff, #00ffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 3s infinite;
        }
       
        @keyframes shimmer {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(30deg); }
        }
       
        #subtitle {
            font-size: 0.9em;
            letter-spacing: 4px;
            opacity: 0.7;
        }
       
        #stats {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: #00ffff;
            font-size: 0.8em;
            opacity: 0.6;
        }
       
        #controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: #00ffff;
            font-size: 0.75em;
            text-align: right;
            opacity: 0.5;
        }
       
        #neural-activity {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 200px;
            padding: 15px;
            background: rgba(0, 20, 40, 0.7);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            color: #00ffff;
            font-size: 0.8em;
        }
       
        #neural-activity h3 {
            margin-bottom: 10px;
            font-weight: 300;
            letter-spacing: 2px;
        }
       
        .activity-bar {
            height: 4px;
            background: rgba(0, 255, 255, 0.2);
            margin: 8px 0;
            border-radius: 2px;
            overflow: hidden;
        }
       
        .activity-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            border-radius: 2px;
            transition: width 0.3s;
        }
       
        .activity-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* New scene controls styles */
        #scene-controls {
            position: fixed;
            top: 80px;
            left: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .scene-btn {
            background: rgba(0, 20, 40, 0.7);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 5px;
            color: #00ffff;
            padding: 8px 16px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
            text-shadow: 0 0 5px #00ffff;
        }

        .scene-btn:hover {
            background: rgba(0, 40, 80, 0.7);
            transform: scale(1.05);
        }

        #file-input {
            display: none;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div id="title">CEREBRAL INTUITION</div>
        <div id="subtitle">NEURAL BIODOME COLONY • TITAN ORBIT</div>
    </div>
   
    <div id="neural-activity">
        <h3>⚡ NEURAL ACTIVITY</h3>
        <div class="activity-label"><span>Synaptic Flow</span><span id="syn-val">0%</span></div>
        <div class="activity-bar"><div class="activity-fill" id="syn-bar" style="width: 0%"></div></div>
        <div class="activity-label"><span>Consciousness Net</span><span id="con-val">0%</span></div>
        <div class="activity-bar"><div class="activity-fill" id="con-bar" style="width: 0%"></div></div>
        <div class="activity-label"><span>Intuition Matrix</span><span id="int-val">0%</span></div>
        <div class="activity-bar"><div class="activity-fill" id="int-bar" style="width: 0%"></div></div>
        <div class="activity-label"><span>Drone Swarm</span><span id="drone-val">0%</span></div>
        <div class="activity-bar"><div class="activity-fill" id="drone-bar" style="width: 0%"></div></div>
    </div>
   
    <div id="stats">
        <div>Population: 12,847 minds</div>
        <div>Drones Active: <span id="drone-count">0</span></div>
        <div>Neural Sync: <span id="sync-rate">0</span>%</div>
    </div>
   
    <div id="controls">
        Drag to orbit • Scroll to zoom<br>
        Click domes to highlight
    </div>

    <!-- New scene controls -->
    <div id="scene-controls">
        <button class="scene-btn" id="new-btn">New Scene</button>
        <button class="scene-btn" id="save-btn">Save Scene</button>
        <button class="scene-btn" id="open-btn">Open Scene</button>
        <input type="file" id="file-input" accept=".md">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Configuration for generative parameters
        let config = {
            time: 0,
            camera_theta: 0,
            camera_phi: Math.PI / 3,
            camera_radius: 30,
            brain_scale: 1.2,
            population: 12847,
            synapse_count: 500,

            // Drone generative params
            drone_count: 15,
            drone_min_orbit_radius: 5,
            drone_max_orbit_radius: 12,
            drone_min_orbit_height: 3,
            drone_max_orbit_height: 9,
            drone_min_orbit_speed: 0.2,
            drone_max_orbit_speed: 0.5,
            drone_min_bob_speed: 1,
            drone_max_bob_speed: 3,
            drone_min_bob_amount: 0.1,
            drone_max_bob_amount: 0.3,
            drone_lsystem_axiom: 'F',
            drone_lsystem_rules: {'F': 'F[+F]F[-F]F'},
            drone_lsystem_iterations: 3,
            drone_lsystem_angle: 25,
            drone_lsystem_angle_variation: 10,
            drone_lsystem_length: 0.2,
            drone_lsystem_length_variation: 0.1,

            // Small dome generative params
            dome_count: 8,
            dome_min_x: -7,
            dome_max_x: 7,
            dome_min_z: -7,
            dome_max_z: 7,
            dome_min_scale: 0.5,
            dome_max_scale: 0.8,
            dome_lsystem_axiom: 'F',
            dome_lsystem_rules: {'F': 'F[+F][-F]'},
            dome_lsystem_iterations: 2,
            dome_lsystem_angle: 30,
            dome_lsystem_angle_variation: 5,
            dome_lsystem_length: 1,
            dome_lsystem_length_variation: 0.2
        };

        // L-System generator function with error handling
        function generateLSystem(axiom, rules, iterations, angle, length) {
            try {
                // Generate the L-System string
                let current = axiom;
                for (let i = 0; i < iterations; i++) {
                    current = current.split('').map(char => rules[char] || char).join('');
                }

                // Turtle interpretation to create line segments
                const positions = [];
                let pos = new THREE.Vector3(0, 0, 0);
                let dir = new THREE.Vector3(0, 1, 0); // Initial direction up
                const stack = [];

                for (let char of current) {
                    if (char === 'F') {
                        const start = pos.clone();
                        pos.add(dir.clone().multiplyScalar(length));
                        positions.push(start.x, start.y, start.z, pos.x, pos.y, pos.z);
                    } else if (char === '+') {
                        dir.applyAxisAngle(new THREE.Vector3(0, 0, 1), (angle * Math.PI) / 180);
                    } else if (char === '-') {
                        dir.applyAxisAngle(new THREE.Vector3(0, 0, 1), -(angle * Math.PI) / 180);
                    } else if (char === '[') {
                        stack.push({ pos: pos.clone(), dir: dir.clone() });
                    } else if (char === ']') {
                        const state = stack.pop();
                        pos = state.pos;
                        dir = state.dir;
                    }
                }

                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
                const material = new THREE.LineBasicMaterial({ color: 0x00ffff });
                return new THREE.LineSegments(geometry, material);
            } catch (e) {
                console.error('L-System generation failed:', e);
                return new THREE.Group(); // Fallback to empty group
            }
        }

        // ... (rest of the code remains the same as previous version)
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multiagent Systems Atlas ‚Äî Phoenix Voltage AI</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;500;600;700;800&family=IBM+Plex+Mono:wght@300;400;500;600;700&family=Chakra+Petch:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.183.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.183.0/examples/jsm/"
  }
}
</script>
<style>
:root {
  --font-size-base: 15px;
  --bg: #06080d;
  --bg2: #0c1018;
  --bg3: #111825;
  --bg4: #172033;
  --accent: #00ffa3;
  --accent2: #00d4ff;
  --accent3: #ff6b35;
  --accent4: #c084fc;
  --accent5: #f43f5e;
  --accent6: #facc15;
  --text: #d1d9e6;
  --text2: #8899b0;
  --text3: #556680;
  --border: #1a2744;
  --border2: #243352;
  --gpt-color: #10b981;
  --claude-color: #e48c57;
  --grok-color: #3b82f6;
  --gemini-color: #a78bfa;
}
* { margin:0; padding:0; box-sizing:border-box; }
html { font-size: var(--font-size-base); scroll-behavior: smooth; }
body { font-family: 'Chakra Petch', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; line-height: 1.65; overflow-x: hidden; }

#three-bg { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; pointer-events: none; opacity: 0.5; }

.toolbar { position: fixed; top: 0; left: 0; right: 0; height: 52px; background: rgba(6,8,13,0.92); backdrop-filter: blur(16px); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 1.2rem; z-index: 1000; gap: 0.6rem; }
.toolbar .logo { font-family: 'Oxanium', sans-serif; font-weight: 800; font-size: 1.1rem; background: linear-gradient(135deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; white-space: nowrap; }
.toolbar .search-box { flex: 1; max-width: 420px; position: relative; margin-left: 1rem; }
.toolbar .search-box input { width: 100%; background: var(--bg3); border: 1px solid var(--border); border-radius: 8px; padding: 0.4rem 0.8rem 0.4rem 2.2rem; color: var(--text); font-family: 'IBM Plex Mono', monospace; font-size: 0.8rem; outline: none; transition: border-color 0.3s; }
.toolbar .search-box input:focus { border-color: var(--accent); }
.toolbar .search-box::before { content: '‚åï'; position: absolute; left: 0.7rem; top: 50%; transform: translateY(-50%); color: var(--text3); font-size: 1rem; }
.toolbar .controls { display: flex; gap: 0.3rem; margin-left: auto; }
.toolbar .controls button { background: var(--bg3); border: 1px solid var(--border); border-radius: 6px; color: var(--text2); font-family: 'IBM Plex Mono', monospace; font-size: 0.75rem; padding: 0.3rem 0.6rem; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
.toolbar .controls button:hover { border-color: var(--accent); color: var(--accent); background: rgba(0,255,163,0.06); }
.search-count { font-family: 'IBM Plex Mono', monospace; font-size: 0.7rem; color: var(--accent); padding: 0.2rem 0.5rem; background: rgba(0,255,163,0.08); border-radius: 4px; position: absolute; right: 8px; top: 50%; transform: translateY(-50%); display: none; }

.sidebar { position: fixed; top: 52px; left: 0; width: 260px; height: calc(100vh - 52px); background: rgba(6,8,13,0.95); border-right: 1px solid var(--border); overflow-y: auto; z-index: 900; padding: 1rem 0; transition: transform 0.3s; }
.sidebar.hidden { transform: translateX(-260px); }
.sidebar::-webkit-scrollbar { width: 3px; }
.sidebar::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }
.nav-section { padding: 0.3rem 1rem; margin-bottom: 0.2rem; }
.nav-section-title { font-family: 'IBM Plex Mono', monospace; font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text3); padding: 0.4rem 0; border-bottom: 1px solid var(--border); margin-bottom: 0.3rem; }
.nav-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.45rem 0.6rem; border-radius: 6px; cursor: pointer; font-size: 0.85rem; color: var(--text2); transition: all 0.2s; text-decoration: none; }
.nav-item:hover { background: var(--bg3); color: var(--text); }
.nav-item.active { background: rgba(0,255,163,0.08); color: var(--accent); }
.nav-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }

.main { margin-left: 260px; margin-top: 52px; padding: 2rem 2.5rem 6rem; position: relative; z-index: 1; max-width: 1100px; transition: margin-left 0.3s; }
.main.expanded { margin-left: 0; }
body.fullscreen .toolbar { display: none; }
body.fullscreen .sidebar { display: none; }
body.fullscreen .main { margin-left: 0; margin-top: 0; max-width: 100%; padding: 2rem 4rem 6rem; }

.section { margin-bottom: 3rem; scroll-margin-top: 70px; }
.section-header { display: flex; align-items: center; gap: 0.8rem; margin-bottom: 1.5rem; padding-bottom: 0.8rem; border-bottom: 2px solid var(--border); position: relative; }
.section-header::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 80px; height: 2px; background: linear-gradient(90deg, var(--accent), transparent); }
.section-icon { font-size: 1.6rem; line-height: 1; }
.section-title { font-family: 'Oxanium', sans-serif; font-size: 1.7rem; font-weight: 700; }
.outline-num { font-family: 'IBM Plex Mono', monospace; font-size: 0.75rem; color: var(--accent); margin-right: 0.5rem; opacity: 0.7; }

.card { background: var(--bg2); border: 1px solid var(--border); border-radius: 10px; padding: 1.5rem 1.8rem; margin-bottom: 1.2rem; position: relative; overflow: hidden; transition: border-color 0.3s, box-shadow 0.3s; }
.card:hover { border-color: var(--border2); box-shadow: 0 4px 30px rgba(0,0,0,0.3); }
.card-bar { position: absolute; top: 0; left: 0; width: 3px; height: 100%; }
.card h3 { font-family: 'Oxanium', sans-serif; font-size: 1.2rem; margin-bottom: 0.8rem; font-weight: 600; }
.card h4 { font-family: 'IBM Plex Mono', monospace; font-size: 0.9rem; margin: 1.2rem 0 0.5rem; color: var(--accent2); }
.card p { color: var(--text2); margin-bottom: 0.6rem; }
.card p strong { color: var(--text); font-weight: 600; }

.ai-card { border-radius: 10px; margin-bottom: 1rem; overflow: hidden; }
.ai-card-header { display: flex; align-items: center; gap: 0.8rem; padding: 0.8rem 1.2rem; cursor: pointer; transition: background 0.2s; user-select: none; }
.ai-card-header:hover { filter: brightness(1.15); }
.ai-badge { font-family: 'Oxanium', sans-serif; font-weight: 700; font-size: 0.85rem; padding: 0.15rem 0.6rem; border-radius: 4px; }
.ai-card-header .arrow { margin-left: auto; font-size: 0.8rem; transition: transform 0.3s; }
.ai-card.open .arrow { transform: rotate(180deg); }
.ai-card-body { max-height: 0; overflow: hidden; transition: max-height 0.5s ease; padding: 0 1.2rem; }
.ai-card.open .ai-card-body { max-height: 8000px; padding: 0.8rem 1.2rem 1.2rem; }
.ai-card-body p { font-size: 0.92rem; color: var(--text2); margin-bottom: 0.5rem; }
.ai-card-body p strong { color: var(--text); }
.ai-card.gpt { background: var(--bg2); border: 1px solid rgba(16,185,129,0.25); }
.ai-card.gpt .ai-card-header { background: rgba(16,185,129,0.08); }
.ai-card.gpt .ai-badge { background: rgba(16,185,129,0.15); color: var(--gpt-color); }
.ai-card.claude { background: var(--bg2); border: 1px solid rgba(228,140,87,0.25); }
.ai-card.claude .ai-card-header { background: rgba(228,140,87,0.08); }
.ai-card.claude .ai-badge { background: rgba(228,140,87,0.15); color: var(--claude-color); }
.ai-card.grok { background: var(--bg2); border: 1px solid rgba(59,130,246,0.25); }
.ai-card.grok .ai-card-header { background: rgba(59,130,246,0.08); }
.ai-card.grok .ai-badge { background: rgba(59,130,246,0.15); color: var(--grok-color); }
.ai-card.gemini { background: var(--bg2); border: 1px solid rgba(167,139,250,0.25); }
.ai-card.gemini .ai-card-header { background: rgba(167,139,250,0.08); }
.ai-card.gemini .ai-badge { background: rgba(167,139,250,0.15); color: var(--gemini-color); }

.data-table { width: 100%; border-collapse: separate; border-spacing: 0; margin: 1rem 0; font-size: 0.88rem; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
.data-table th { font-family: 'IBM Plex Mono', monospace; font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.08em; padding: 0.7rem 0.9rem; text-align: left; background: var(--bg3); color: var(--accent); border-bottom: 2px solid var(--border); position: sticky; top: 0; }
.data-table td { padding: 0.6rem 0.9rem; border-bottom: 1px solid var(--border); color: var(--text2); vertical-align: top; }
.data-table tr:last-child td { border-bottom: none; }
.data-table tr:hover td { background: rgba(0,255,163,0.03); }
.cell-yes { color: var(--accent); font-weight: 600; }
.cell-warn { color: var(--accent6); }
.cell-no { color: var(--text3); }

.tag { display: inline-block; padding: 0.15rem 0.5rem; border-radius: 4px; font-family: 'IBM Plex Mono', monospace; font-size: 0.7rem; margin: 0.1rem; font-weight: 500; }
.tag-green { background: rgba(0,255,163,0.1); color: var(--accent); }
.tag-blue { background: rgba(0,212,255,0.1); color: var(--accent2); }
.tag-orange { background: rgba(255,107,53,0.1); color: var(--accent3); }
.tag-purple { background: rgba(192,132,252,0.1); color: var(--accent4); }

.score-row { display: flex; align-items: center; gap: 0.8rem; margin: 0.5rem 0; }
.score-label { font-family: 'IBM Plex Mono', monospace; font-size: 0.78rem; color: var(--text2); min-width: 200px; }
.score-track { flex: 1; height: 7px; background: rgba(255,255,255,0.04); border-radius: 4px; overflow: hidden; }
.score-fill { height: 100%; border-radius: 4px; transition: width 1.2s ease; }
.score-val { font-family: 'IBM Plex Mono', monospace; font-size: 0.78rem; font-weight: 700; min-width: 36px; text-align: right; }

.verdict { display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.35rem 0.8rem; border-radius: 6px; font-family: 'IBM Plex Mono', monospace; font-size: 0.75rem; font-weight: 600; margin: 0.2rem; }
.verdict-yes { background: rgba(0,255,163,0.1); color: var(--accent); border: 1px solid rgba(0,255,163,0.25); }
.verdict-warn { background: rgba(250,204,21,0.1); color: var(--accent6); border: 1px solid rgba(250,204,21,0.25); }

.code { background: #080c14; border: 1px solid var(--border); border-radius: 8px; padding: 1.1rem 1.3rem; margin: 0.8rem 0; font-family: 'IBM Plex Mono', monospace; font-size: 0.78rem; line-height: 1.65; color: #b4c0d4; overflow-x: auto; white-space: pre-wrap; word-break: break-word; }
.code .kw { color: #ff7b72; } .code .str { color: #a5d6ff; } .code .fn { color: #d2a8ff; } .code .cm { color: #556680; } .code .cls { color: #79c0ff; }

.callout { border-left: 3px solid var(--accent); padding: 0.9rem 1.3rem; margin: 1rem 0; background: rgba(0,255,163,0.03); border-radius: 0 8px 8px 0; }
.callout.warn { border-left-color: var(--accent6); background: rgba(250,204,21,0.03); }
.callout.info { border-left-color: var(--accent2); background: rgba(0,212,255,0.03); }
.callout p { color: var(--text2); font-size: 0.9rem; margin-bottom: 0.4rem; }

.mermaid-wrap { margin: 1.2rem 0; background: var(--bg3); border-radius: 10px; padding: 1.5rem; border: 1px solid var(--border); overflow-x: auto; }

.viewport-3d { width: 100%; height: 540px; border-radius: 12px; border: 1px solid var(--border); margin: 1.2rem 0; background: #020406; position: relative; overflow: hidden; box-shadow: 0 8px 40px rgba(0,0,0,0.5), inset 0 1px 0 rgba(0,255,163,0.05); }
.viewport-3d canvas { border-radius: 12px; display: block; }
.viewport-label { position: absolute; bottom: 0.8rem; left: 1rem; font-family: 'IBM Plex Mono', monospace; font-size: 0.7rem; color: var(--text3); background: rgba(2,4,6,0.88); padding: 0.25rem 0.7rem; border-radius: 4px; pointer-events: none; z-index: 5; }
.viewport-hud { position: absolute; top: 0.8rem; right: 1rem; font-family: 'IBM Plex Mono', monospace; font-size: 0.72rem; color: var(--accent); background: rgba(2,4,6,0.9); padding: 0.3rem 0.8rem; border-radius: 5px; pointer-events: none; z-index: 5; border: 1px solid rgba(0,255,163,0.15); transition: border-color 0.3s, color 0.3s; min-width: 200px; text-align: center; letter-spacing: 0.03em; backdrop-filter: blur(6px); }

.search-match { background: rgba(0,255,163,0.2); border-radius: 2px; padding: 0 2px; }
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1.2rem; }
@media (max-width: 900px) { .sidebar { width: 220px; } .main { margin-left: 220px; padding: 1.5rem; } .two-col { grid-template-columns: 1fr; } .score-label { min-width: 140px; font-size: 0.7rem; } }
@media (max-width: 700px) { .sidebar { transform: translateX(-260px); } .main { margin-left: 0; } }
</style>
</head>
<body>

<canvas id="three-bg"></canvas>

<div class="toolbar">
  <div class="logo">MULTIAGENT ATLAS</div>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Search content... (Ctrl+K)" />
    <span id="searchCount" class="search-count"></span>
  </div>
  <div class="controls">
    <button onclick="adjustFont(-1)">A‚àí</button>
    <button onclick="adjustFont(1)">A+</button>
    <button onclick="adjustFont(0)">A‚äò</button>
    <button onclick="toggleSidebar()">‚ò∞</button>
    <button onclick="toggleFullscreen()">‚õ∂</button>
  </div>
</div>

<nav class="sidebar" id="sidebar">
  <div class="nav-section"><div class="nav-section-title">Overview</div>
    <a class="nav-item active" href="#verdict" onclick="navTo(this,'verdict')"><div class="nav-dot" style="background:var(--accent)"></div> TL;DR Verdict</a>
    <a class="nav-item" href="#scores" onclick="navTo(this,'scores')"><div class="nav-dot" style="background:var(--accent2)"></div> Fit Scores</a>
    <a class="nav-item" href="#3d-agents" onclick="navTo(this,'3d-agents')"><div class="nav-dot" style="background:var(--accent4)"></div> 3D Agent Map</a>
  </div>
  <div class="nav-section"><div class="nav-section-title">Comparisons</div>
    <a class="nav-item" href="#head-to-head" onclick="navTo(this,'head-to-head')"><div class="nav-dot" style="background:var(--accent3)"></div> Head-to-Head Table</a>
    <a class="nav-item" href="#smolagents-gives" onclick="navTo(this,'smolagents-gives')"><div class="nav-dot" style="background:var(--accent)"></div> What smolagents Gives</a>
    <a class="nav-item" href="#architecture-diagram" onclick="navTo(this,'architecture-diagram')"><div class="nav-dot" style="background:var(--accent2)"></div> Architecture Diagrams</a>
  </div>
  <div class="nav-section"><div class="nav-section-title">Deep Dives</div>
    <a class="nav-item" href="#sft-pipeline" onclick="navTo(this,'sft-pipeline')"><div class="nav-dot" style="background:var(--accent4)"></div> SFT Pipeline</a>
    <a class="nav-item" href="#vs-vectordb" onclick="navTo(this,'vs-vectordb')"><div class="nav-dot" style="background:var(--accent6)"></div> vs. Vector DBs</a>
    <a class="nav-item" href="#agent-families" onclick="navTo(this,'agent-families')"><div class="nav-dot" style="background:var(--accent)"></div> Agent Family Mapping</a>
    <a class="nav-item" href="#roadmap" onclick="navTo(this,'roadmap')"><div class="nav-dot" style="background:var(--accent3)"></div> Action Roadmap</a>
  </div>
  <div class="nav-section"><div class="nav-section-title">AI Perspectives</div>
    <a class="nav-item" href="#ai-perspectives" onclick="navTo(this,'ai-perspectives')"><div class="nav-dot" style="background:var(--gpt-color)"></div> GPT / Claude / Grok / Gemini</a>
  </div>
  <div class="nav-section"><div class="nav-section-title">Reference</div>
    <a class="nav-item" href="#openclaw-ref" onclick="navTo(this,'openclaw-ref')"><div class="nav-dot" style="background:var(--text3)"></div> OpenClaw Reference</a>
    <a class="nav-item" href="#aaron-stack" onclick="navTo(this,'aaron-stack')"><div class="nav-dot" style="background:var(--accent)"></div> Aaron Stack Design</a>
    <a class="nav-item" href="#tech-ref" onclick="navTo(this,'tech-ref')"><div class="nav-dot" style="background:var(--accent2)"></div> Tech Quick Ref</a>
  </div>
</nav>

<div class="main" id="mainContent">

  <!-- VERDICT -->
  <div class="section" id="verdict">
    <div class="section-header"><span class="section-icon">‚ö°</span><span class="section-title"><span class="outline-num">1.</span>TL;DR Verdict</span></div>
    <div class="card"><div class="card-bar" style="background:var(--accent)"></div>
      <h3>Bottom Line: Yes ‚Äî Invest Deeper in smolagents</h3>
      <p>smolagents is <strong>architecturally aligned</strong> with your stack at every level. ~1000 lines core, Python-native, model-agnostic, code-first. You're already past the learning curve.</p>
      <div class="callout"><p><strong>Key insight:</strong> smolagents is the <strong>execution engine</strong> inside your agents. Your Organization, Market, Vision, Summary, Publication, and Performance agents are the brain. smolagents is the hands.</p></div>
      <p><strong>All four AIs</strong> (GPT, Claude, Grok, Gemini) converge on the same architecture. None mentioned smolagents ‚Äî that's the gap it fills.</p>
      <div style="margin-top:1rem">
        <div class="verdict verdict-yes">‚úÖ LEARN DEEPER</div><div class="verdict verdict-yes">‚úÖ SFT PIPELINE</div><div class="verdict verdict-warn">‚ö†Ô∏è VECTOR DB PARTIAL</div><div class="verdict verdict-warn">‚ö†Ô∏è ORCHESTRATION LIGHT</div><div class="verdict verdict-yes">‚úÖ STACK ALIGNED</div>
      </div>
    </div>
  </div>

  <!-- SCORES -->
  <div class="section" id="scores">
    <div class="section-header"><span class="section-icon">üìä</span><span class="section-title"><span class="outline-num">2.</span>Strategic Fit Scores</span></div>
    <div class="card"><div class="card-bar" style="background:var(--accent2)"></div>
      <div class="score-row"><span class="score-label">Stack Philosophy Match</span><div class="score-track"><div class="score-fill" data-w="95" style="width:0;background:var(--accent)"></div></div><span class="score-val" style="color:var(--accent)">95%</span></div>
      <div class="score-row"><span class="score-label">SFT Post-Training Loop</span><div class="score-track"><div class="score-fill" data-w="90" style="width:0;background:var(--accent)"></div></div><span class="score-val" style="color:var(--accent)">90%</span></div>
      <div class="score-row"><span class="score-label">Vector DB Replacement</span><div class="score-track"><div class="score-fill" data-w="70" style="width:0;background:var(--accent6)"></div></div><span class="score-val" style="color:var(--accent6)">70%</span></div>
      <div class="score-row"><span class="score-label">Multi-Agent Orchestration</span><div class="score-track"><div class="score-fill" data-w="65" style="width:0;background:var(--accent6)"></div></div><span class="score-val" style="color:var(--accent6)">65%</span></div>
      <div class="score-row"><span class="score-label">HTML/JS Client Compat</span><div class="score-track"><div class="score-fill" data-w="85" style="width:0;background:var(--accent)"></div></div><span class="score-val" style="color:var(--accent)">85%</span></div>
      <div class="score-row"><span class="score-label">Code-as-Action Match</span><div class="score-track"><div class="score-fill" data-w="98" style="width:0;background:var(--accent)"></div></div><span class="score-val" style="color:var(--accent)">98%</span></div>
      <div class="score-row"><span class="score-label">HF Ecosystem Leverage</span><div class="score-track"><div class="score-fill" data-w="92" style="width:0;background:var(--accent)"></div></div><span class="score-val" style="color:var(--accent)">92%</span></div>
    </div>
  </div>

  <!-- 3D AGENT MAP -->
  <div class="section" id="3d-agents">
    <div class="section-header"><span class="section-icon">üåê</span><span class="section-title"><span class="outline-num">3.</span>Interactive Agent Constellation</span></div>
    <div class="viewport-3d" id="agentViewport">
      <div class="viewport-hud" id="hoverInfo">HOVER NODES FOR INFO</div>
      <div class="viewport-label">Drag to orbit ¬∑ Scroll to zoom ¬∑ Click nodes</div>
    </div>
  </div>

  <!-- HEAD-TO-HEAD -->
  <div class="section" id="head-to-head">
    <div class="section-header"><span class="section-icon">‚öîÔ∏è</span><span class="section-title"><span class="outline-num">4.</span>Head-to-Head Comparison</span></div>
    <div class="card" style="overflow-x:auto"><div class="card-bar" style="background:var(--accent2)"></div>
      <table class="data-table"><thead><tr><th>Dimension</th><th>OpenClaw</th><th>smolagents</th><th>Your Stack</th></tr></thead><tbody>
        <tr><td><strong>Runtime</strong></td><td class="cell-no">Node.js + pnpm ‚ùå</td><td class="cell-yes">Pure Python ‚úÖ</td><td class="cell-yes">Python + HTML/JS ‚úÖ</td></tr>
        <tr><td><strong>Code Size</strong></td><td class="cell-no">Massive monorepo</td><td class="cell-yes">~1000 lines core</td><td class="cell-warn">TBD (&lt;5k LOC)</td></tr>
        <tr><td><strong>Agent Paradigm</strong></td><td>Plugin/skill registry</td><td class="cell-yes">Code-as-action (Python)</td><td>Custom agent classes</td></tr>
        <tr><td><strong>Model Support</strong></td><td>Anthropic, OpenAI, Ollama</td><td class="cell-yes">100+ via LiteLLM</td><td>Grok, GPT, Gemini, Claude</td></tr>
        <tr><td><strong>Local Models</strong></td><td class="cell-no">Ollama only</td><td class="cell-yes">Transformers, vLLM, Ollama, MLX</td><td class="cell-warn">Needs connectors</td></tr>
        <tr><td><strong>Tool Framework</strong></td><td>Plugin SDK</td><td class="cell-yes">@tool + MCP + Hub</td><td>Custom functions</td></tr>
        <tr><td><strong>Sandboxing</strong></td><td>Docker</td><td class="cell-yes">Docker, E2B, Modal, Pyodide</td><td class="cell-warn">None built-in</td></tr>
        <tr><td><strong>Multi-Agent</strong></td><td class="cell-yes">Full orchestration</td><td class="cell-warn">ManagedAgent (hierarchy)</td><td class="cell-yes">Your 6 agents</td></tr>
        <tr><td><strong>Messaging</strong></td><td class="cell-yes">WA, Telegram, Discord</td><td class="cell-no">Not built-in</td><td>XPro + GMsgs</td></tr>
        <tr><td><strong>npm?</strong></td><td class="cell-no">Yes ‚ùå</td><td class="cell-yes">No ‚úÖ</td><td class="cell-yes">No ‚úÖ</td></tr>
        <tr><td><strong>SFT Integration</strong></td><td class="cell-no">None</td><td class="cell-yes">TransformersModel native</td><td class="cell-warn">Custom</td></tr>
      </tbody></table>
    </div>
  </div>

  <!-- WHAT SMOLAGENTS GIVES -->
  <div class="section" id="smolagents-gives">
    <div class="section-header"><span class="section-icon">üéÅ</span><span class="section-title"><span class="outline-num">5.</span>Free vs. Build Yourself</span></div>
    <div class="two-col">
      <div class="card"><div class="card-bar" style="background:var(--accent)"></div><h3>Free From smolagents</h3>
        <p>‚Üí ReAct loop + error recovery</p><p>‚Üí Code execution + sandboxing</p><p>‚Üí Model-agnostic (100+ LLMs)</p><p>‚Üí @tool decorator</p><p>‚Üí MCP server compat</p><p>‚Üí ManagedAgent multi-agent</p><p>‚Üí Vision/audio/video inputs</p><p>‚Üí HF Hub sharing</p><p>‚Üí Step logging + debug</p><p>‚Üí TransformersModel for SFT</p>
      </div>
      <div class="card"><div class="card-bar" style="background:var(--accent3)"></div><h3>You Still Build</h3>
        <p>‚Üí XPro + GMsgs connectors</p><p>‚Üí Playwright layer</p><p>‚Üí Camera / KB / clipboard</p><p>‚Üí Three.js 3D shell</p><p>‚Üí FastAPI WebSocket hub</p><p>‚Üí GitHub Pages deploy</p><p>‚Üí Cross-session memory</p><p>‚Üí A/B scoring engine</p><p>‚Üí Healthcare domain tools</p>
      </div>
    </div>
  </div>

  <!-- ARCHITECTURE DIAGRAMS -->
  <div class="section" id="architecture-diagram">
    <div class="section-header"><span class="section-icon">üèóÔ∏è</span><span class="section-title"><span class="outline-num">6.</span>Architecture Diagrams</span></div>
    <div class="card"><div class="card-bar" style="background:var(--accent2)"></div><h3>smolagents Inside Your Stack</h3>
      <div class="mermaid-wrap"><div class="mermaid">
graph TB
    subgraph CLIENT["üñ•Ô∏è HTML/JS CLIENT"]
        SHELL["Three.js 3D Shell"] --- APPS["App Gallery"]
        MEDIA_C["Media IO"] --- WS_C["WebSocket Client"]
    end
    subgraph SERVER["üêç FastAPI + Uvicorn"]
        ROUTES["Routes"] --- GRADIO["Gradio"]
        STREAM["Streamlit"] --- PW2["Playwright"]
    end
    subgraph AGENTS["üß† AGENT LAYER"]
        ORG["Organization"] --- MKT["Market"]
        VIS["Vision"] --- SUM["Summary"]
        PUB["Publication"] --- PERF["Performance"]
    end
    subgraph SMOL["‚≠ê smolagents"]
        CA["CodeAgent"] --- TCA["ToolCallingAgent"]
        MA["ManagedAgent"] --- TOOLS["@tool Registry"]
        TM["TransformersModel"] --- LM["LiteLLMModel"]
    end
    subgraph MODELS["‚òÅÔ∏è MODELS"]
        GROK["Grok"] --- GPT["GPT"]
        GEM["Gemini"] --- CL["Claude"]
        LOCAL["Local SFT"]
    end
    CLIENT -->|HTTP/WS| SERVER
    SERVER --> AGENTS
    AGENTS --> SMOL
    SMOL --> MODELS
    TM --> LOCAL
      </div></div>
    </div>
    <div class="card"><div class="card-bar" style="background:var(--accent4)"></div><h3>SFT ‚Üí Agent Evaluation Flow</h3>
      <div class="mermaid-wrap"><div class="mermaid">
graph LR
    A["üéì SFT Training"] --> B["üì¶ Checkpoint"]
    B --> C["‚≠ê TransformersModel"]
    C --> D["üõ†Ô∏è CodeAgent + Tools"]
    D --> E["üìã Benchmarks"]
    E --> F["üìä Score"]
    F --> G{"Pass?"}
    G -->|Yes| H["üöÄ Deploy"]
    G -->|No| I["üîÑ Iterate"]
    I --> A
      </div></div>
    </div>
  </div>

  <!-- SFT PIPELINE -->
  <div class="section" id="sft-pipeline">
    <div class="section-header"><span class="section-icon">üß™</span><span class="section-title"><span class="outline-num">7.</span>SFT ‚Üí smolagents Pipeline</span></div>
    <div class="card"><div class="card-bar" style="background:var(--accent4)"></div>
      <h3>The Killer Use Case</h3>
      <p><code>TransformersModel</code> loads any local checkpoint directly as an agent brain. No API keys, no deployment.</p>
      <div class="code"><span class="kw">from</span> smolagents <span class="kw">import</span> <span class="cls">CodeAgent</span>, <span class="cls">TransformersModel</span>, tool

<span class="cm"># Load fine-tuned student model</span>
model = <span class="cls">TransformersModel</span>(model_id=<span class="str">"./checkpoints/my-sft-v3"</span>, device=<span class="str">"cuda"</span>)

<span class="kw">@tool</span>
<span class="kw">def</span> <span class="fn">extract_clinical_findings</span>(text: str) -> str:
    <span class="str">"""Extracts structured clinical findings.
    Args: text: Raw clinical text"""</span>
    <span class="kw">return</span> structured_output

agent = <span class="cls">CodeAgent</span>(tools=[extract_clinical_findings], model=model, max_steps=<span class="fn">5</span>)
result = agent.run(<span class="str">"Analyze pneumonia risk factors..."</span>)</div>
      <h4>Ecosystem Synergy</h4>
      <p><span class="tag tag-purple">transformers + trl + peft</span> ‚Üí Train ¬∑ <span class="tag tag-green">smolagents</span> ‚Üí Test ¬∑ <span class="tag tag-blue">datasets + evaluate</span> ‚Üí Score ¬∑ <span class="tag tag-orange">Hub</span> ‚Üí Share</p>
    </div>
  </div>

  <!-- VS VECTOR DB -->
  <div class="section" id="vs-vectordb">
    <div class="section-header"><span class="section-icon">üîÄ</span><span class="section-title"><span class="outline-num">8.</span>vs. Vector Databases</span></div>
    <div class="card"><div class="card-bar" style="background:var(--accent6)"></div>
      <h3>Agent Wins ‚úÖ</h3>
      <table class="data-table"><thead><tr><th>Use Case</th><th>Why</th></tr></thead><tbody>
        <tr><td>Domain Q&A (trained)</td><td class="cell-yes">Knowledge baked in via SFT</td></tr>
        <tr><td>Clinical scoring</td><td class="cell-yes">Model learns logic, agent applies tools</td></tr>
        <tr><td>PDF extraction</td><td class="cell-yes">Vision + code agent > RAG chunking</td></tr>
        <tr><td>Multi-step reasoning</td><td class="cell-yes">ReAct chains tools; RAG is one-shot</td></tr>
      </tbody></table>
      <h3>Vector DB Wins ‚ö†Ô∏è</h3>
      <table class="data-table"><thead><tr><th>Use Case</th><th>Why</th></tr></thead><tbody>
        <tr><td>10k+ documents</td><td class="cell-warn">Can't memorize all. Needs indexing.</td></tr>
        <tr><td>Constantly updating</td><td class="cell-warn">Re-training is slow. Ingestion instant.</td></tr>
        <tr><td>Exact passage retrieval</td><td class="cell-warn">Search problem, not agent problem.</td></tr>
      </tbody></table>
      <div class="callout info"><p><strong>Hybrid:</strong> FAISS as @tool ‚Äî agent decides WHEN to retrieve vs. use trained knowledge.</p></div>
    </div>
  </div>

  <!-- AGENT FAMILIES -->
  <div class="section" id="agent-families">
    <div class="section-header"><span class="section-icon">üß¨</span><span class="section-title"><span class="outline-num">9.</span>Agent Family Mapping</span></div>
    <div class="card" style="overflow-x:auto"><div class="card-bar" style="background:var(--accent)"></div>
      <table class="data-table"><thead><tr><th>Agent</th><th>smolagents Role</th><th>Pattern</th></tr></thead><tbody>
        <tr><td><strong>Organization</strong></td><td>ManagedAgent orchestrator</td><td class="cell-yes">Routes to sub-agents</td></tr>
        <tr><td><strong>Market</strong></td><td>CodeAgent + web tools</td><td>WebSearch + scrapers</td></tr>
        <tr><td><strong>Vision</strong></td><td>CodeAgent + vision model</td><td class="cell-yes">Native vision inputs</td></tr>
        <tr><td><strong>Summary</strong></td><td>CodeAgent + retrieval</td><td>Student-model-as-agent prime</td></tr>
        <tr><td><strong>Publication</strong></td><td>CodeAgent + file tools</td><td>Writes Python for PDF/MD</td></tr>
        <tr><td><strong>Performance</strong></td><td>Eval harness wrapper</td><td class="cell-yes">Meta-tests other agents</td></tr>
      </tbody></table>
    </div>
  </div>

  <!-- ROADMAP -->
  <div class="section" id="roadmap">
    <div class="section-header"><span class="section-icon">üó∫Ô∏è</span><span class="section-title"><span class="outline-num">10.</span>Action Roadmap</span></div>
    <div class="card"><div class="card-bar" style="background:var(--accent)"></div>
      <h4>Phase 1 ‚Äî SFT Eval (Now ‚Üí 1wk)</h4><p>Train ‚Üí TransformersModel ‚Üí CodeAgent benchmarks ‚Üí score.</p><div class="verdict verdict-yes">‚úÖ Highest ROI</div>
      <h4>Phase 2 ‚Äî Agentic RAG @tool (Wk 2)</h4><p>FAISS as @tool. Summary Agent first.</p><div class="verdict verdict-yes">‚úÖ Eliminates vector DB burden</div>
      <h4>Phase 3 ‚Äî Agent Families (Wk 3-4)</h4><p>Migrate 6 agents to smolagents runtime.</p><div class="verdict verdict-warn">‚ö†Ô∏è Design tools carefully</div>
      <h4>Phase 4 ‚Äî FastAPI Bridge (Wk 5)</h4><p>WS endpoints ‚Üí Three.js frontend streams.</p><div class="verdict verdict-warn">‚ö†Ô∏è Custom work needed</div>
      <h4>Phase 5 ‚Äî Model Party (Wk 6)</h4><p>4-model routing via LiteLLMModel.</p><div class="verdict verdict-yes">‚úÖ Model swapping trivial</div>
    </div>
    <div class="card"><div class="card-bar" style="background:var(--accent5)"></div>
      <h3>Don't Use smolagents For:</h3>
      <p><strong>Messaging</strong> ‚Äî Playwright is better custom. <strong>UI</strong> ‚Äî Three.js is separate. <strong>Complex orchestration</strong> ‚Äî ManagedAgent is simple.</p>
      <div class="callout warn"><p><strong>Risk:</strong> Over-investing in smolagents' multi-agent when your Organization Agent already handles coordination.</p></div>
    </div>
  </div>

  <!-- AI PERSPECTIVES -->
  <div class="section" id="ai-perspectives">
    <div class="section-header"><span class="section-icon">ü§ñ</span><span class="section-title"><span class="outline-num">11.</span>All Four AI Perspectives</span></div>
    <div class="ai-card gpt" onclick="toggleAI(this)"><div class="ai-card-header"><div class="ai-badge">GPT</div><span>smolagents as "Execution Kernel" ‚Äî Forge is the OS</span><span class="arrow">‚ñº</span></div><div class="ai-card-body">
      <p><strong>"Forge is the OS; smolagents is one of the processes."</strong></p>
      <p><strong>Unique:</strong> Vector DB postponement (SQLite FTS + ripgrep first). Six specific @tool functions (vault_search, pdf_ingest, playwright_action, score_output, ab_assign, model_eval). Clean module: <code>run_agent(agent_name, input_bundle, tool_registry, policy)</code>.</p>
      <p><strong>Warns:</strong> Code execution risk, determinism caps, separation of concerns.</p>
    </div></div>
    <div class="ai-card claude" onclick="toggleAI(this)"><div class="ai-card-header"><div class="ai-badge">CLAUDE</div><span>SFT Pipeline as Killer App ‚Äî "Brain vs Hands"</span><span class="arrow">‚ñº</span></div><div class="ai-card-body">
      <p><strong>"smolagents is the hands. Your agents are the brain."</strong></p>
      <p><strong>Unique:</strong> TransformersModel as the bridge no other framework offers. Agent-decides-when-to-retrieve FAISS pattern. Quantified fit scores. Four-model gap identification.</p>
      <p><strong>Best for:</strong> Visual analysis, code examples, explicit guardrails on what NOT to use it for.</p>
    </div></div>
    <div class="ai-card grok" onclick="toggleAI(this)"><div class="ai-card-header"><div class="ai-badge">GROK</div><span>Most Comprehensive ‚Äî "Marginal learning cost near zero"</span><span class="arrow">‚ñº</span></div><div class="ai-card-body">
      <p><strong>"This combination (Aaron Stack + smolagents inside) is the sweet spot."</strong></p>
      <p><strong>Unique:</strong> Pyodide+Deno sandbox matches your in-browser Python. Memory via student model reasoning over SQLite logs. Seven-step integration plan startable today. Most detailed OpenClaw src/ walkthrough.</p>
      <p><strong>Best for:</strong> Implementation-ready detail, immediate action steps.</p>
    </div></div>
    <div class="ai-card gemini" onclick="toggleAI(this)"><div class="ai-card-header"><div class="ai-badge">GEMINI</div><span>Strategic "Missing Link" ‚Äî Agentic Memory Concept</span><span class="arrow">‚ñº</span></div><div class="ai-card-body">
      <p><strong>"smolagents is the missing link between Python Backend and Playwright Tools."</strong></p>
      <p><strong>Unique:</strong> "Agentic Memory" ‚Äî active (agent looks) vs passive (cosine similarity). Code-first IO alignment (agent outputs Python, not text). "Stateless system, stateful execution."</p>
      <p><strong>Best for:</strong> Philosophical framing, Playwright wrapping pattern (OmniBrowser tool class).</p>
    </div></div>
  </div>

  <!-- OPENCLAW REF -->
  <div class="section" id="openclaw-ref">
    <div class="section-header"><span class="section-icon">ü¶Ä</span><span class="section-title"><span class="outline-num">12.</span>OpenClaw Reference</span></div>
    <div class="card"><div class="card-bar" style="background:var(--text3)"></div>
      <table class="data-table"><thead><tr><th>Component</th><th>OpenClaw</th><th>Your Alternative</th></tr></thead><tbody>
        <tr><td>Gateway</td><td>WS control plane</td><td class="cell-yes">FastAPI + Uvicorn</td></tr>
        <tr><td>Channels</td><td>WA, Telegram, etc.</td><td>Playwright: XPro + GMsgs</td></tr>
        <tr><td>Agent Runtime</td><td>Pi agent RPC</td><td class="cell-yes">smolagents CodeAgent</td></tr>
        <tr><td>Skills</td><td>ClawHub</td><td class="cell-yes">@tool + HF Hub</td></tr>
        <tr><td>Canvas</td><td>A2UI</td><td class="cell-yes">Three.js 3D shell</td></tr>
        <tr><td>npm/Node</td><td>TypeScript</td><td class="cell-no">‚ùå Rejected</td></tr>
      </tbody></table>
    </div>
  </div>

  <!-- AARON STACK -->
  <div class="section" id="aaron-stack">
    <div class="section-header"><span class="section-icon">üîß</span><span class="section-title"><span class="outline-num">13.</span>Aaron Stack Consensus</span></div>
    <div class="card"><div class="card-bar" style="background:var(--accent)"></div>
      <table class="data-table"><thead><tr><th>Principle</th><th>Implementation</th></tr></thead><tbody>
        <tr><td>No npm</td><td class="cell-yes">Vanilla HTML+JS+CDN</td></tr>
        <tr><td>Server = Python</td><td class="cell-yes">FastAPI + Gradio + Streamlit</td></tr>
        <tr><td>Deploy = GitActions</td><td class="cell-yes">SSL static, hundreds of apps</td></tr>
        <tr><td>GPU-aware client</td><td class="cell-yes">WebGL/WebGPU via Three.js</td></tr>
        <tr><td>4 Model Party</td><td>Grok ‚Üí GPT ‚Üí Gemini ‚Üí Claude</td></tr>
        <tr><td>6 Agent Families</td><td>Org, Mkt, Vis, Sum, Pub, Perf</td></tr>
        <tr><td>&lt;5k LOC</td><td class="cell-warn">Target</td></tr>
      </tbody></table>
    </div>
  </div>

  <!-- TECH REF -->
  <div class="section" id="tech-ref">
    <div class="section-header"><span class="section-icon">‚öôÔ∏è</span><span class="section-title"><span class="outline-num">14.</span>Tech Quick Reference</span></div>
    <div class="card" style="overflow-x:auto"><div class="card-bar" style="background:var(--accent2)"></div>
      <table class="data-table"><thead><tr><th>Need</th><th>Tool</th><th>Status</th></tr></thead><tbody>
        <tr><td>3D GPU UI</td><td>Three.js / Babylon.js</td><td class="cell-yes">Ready</td></tr>
        <tr><td>Physics</td><td>Matter.js / Cannon.js</td><td class="cell-yes">Ready</td></tr>
        <tr><td>Browser control</td><td>Playwright</td><td class="cell-yes">Ready</td></tr>
        <tr><td>HTTP server</td><td>FastAPI + Uvicorn</td><td class="cell-yes">Ready</td></tr>
        <tr><td>Agent runtime</td><td>smolagents CodeAgent</td><td class="cell-yes">Integrated</td></tr>
        <tr><td>SFT Testing</td><td>smolagents + TransformersModel</td><td class="cell-yes">Integrated</td></tr>
        <tr><td>Deploy</td><td>GitHub Pages + GitActions</td><td class="cell-yes">Ready</td></tr>
        <tr><td>Scoring/ABTest</td><td>Custom Python</td><td class="cell-warn">To Build</td></tr>
      </tbody></table>
    </div>
  </div>

</div>

<!-- ===== THREE.JS MODULE SCRIPTS ===== -->
<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
import { OutputPass } from 'three/addons/postprocessing/OutputPass.js';

// ==========================================================
//  HELPER: Canvas-based text sprite
// ==========================================================
function makeTextSprite(text, color = '#d1d9e6', fontSize = 48) {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = 512; canvas.height = 128;
  ctx.clearRect(0, 0, 512, 128);
  ctx.font = `bold ${fontSize}px 'Segoe UI', Arial, sans-serif`;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillStyle = color;
  ctx.shadowColor = color;
  ctx.shadowBlur = 12;
  ctx.fillText(text, 256, 64);
  const tex = new THREE.CanvasTexture(canvas);
  tex.minFilter = THREE.LinearFilter;
  const mat = new THREE.SpriteMaterial({ map: tex, transparent: true, opacity: 0.85, depthWrite: false, blending: THREE.AdditiveBlending });
  const sprite = new THREE.Sprite(mat);
  sprite.scale.set(3, 0.75, 1);
  return sprite;
}

// ==========================================================
//  BACKGROUND ‚Äî Deep space nebula with bloom
// ==========================================================
(function initBackground() {
  const canvas = document.getElementById('three-bg');
  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.toneMapping = THREE.ACESFilmicToneMapping;
  renderer.toneMappingExposure = 0.9;

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 800);
  camera.position.set(0, 5, 35);

  // Post-processing bloom
  const composer = new EffectComposer(renderer);
  composer.addPass(new RenderPass(scene, camera));
  const bloom = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 0.6, 0.8, 0.3);
  composer.addPass(bloom);
  composer.addPass(new OutputPass());

  // Nebula particle cloud ‚Äî multicolor, layered
  const layers = [
    { count: 1200, spread: 100, flatten: 0.3, colors: [0x00ffa3, 0x00d4ff], sizeRange: [0.06, 0.18] },
    { count: 800,  spread: 60,  flatten: 0.5, colors: [0xc084fc, 0x3b82f6], sizeRange: [0.04, 0.12] },
    { count: 600,  spread: 40,  flatten: 0.7, colors: [0xff6b35, 0xf43f5e], sizeRange: [0.03, 0.08] },
  ];

  layers.forEach(layer => {
    const pos = new Float32Array(layer.count * 3);
    const col = new Float32Array(layer.count * 3);
    for (let i = 0; i < layer.count; i++) {
      const r = 5 + Math.random() * layer.spread;
      const theta = Math.random() * Math.PI * 2;
      const phi = Math.acos(2 * Math.random() - 1);
      pos[i*3]   = r * Math.sin(phi) * Math.cos(theta);
      pos[i*3+1] = r * Math.sin(phi) * Math.sin(theta) * layer.flatten;
      pos[i*3+2] = r * Math.cos(phi);
      const c = new THREE.Color(layer.colors[Math.floor(Math.random() * layer.colors.length)]);
      col[i*3] = c.r; col[i*3+1] = c.g; col[i*3+2] = c.b;
    }
    const geo = new THREE.BufferGeometry();
    geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
    geo.setAttribute('color', new THREE.BufferAttribute(col, 3));
    const mat = new THREE.PointsMaterial({
      size: layer.sizeRange[0] + Math.random() * (layer.sizeRange[1] - layer.sizeRange[0]),
      vertexColors: true, transparent: true, opacity: 0.7,
      sizeAttenuation: true, blending: THREE.AdditiveBlending, depthWrite: false
    });
    const pts = new THREE.Points(geo, mat);
    pts.userData.layer = layer;
    scene.add(pts);
  });

  // Energy rings (torus)
  const torusGroup = new THREE.Group();
  for (let i = 0; i < 7; i++) {
    const r = 8 + i * 5.5;
    const geo = new THREE.TorusGeometry(r, 0.02 + Math.random() * 0.03, 6, 160);
    const mat = new THREE.MeshBasicMaterial({
      color: [0x00ffa3, 0x00d4ff, 0xc084fc, 0x1a2744, 0x3b82f6, 0xff6b35, 0xfacc15][i],
      transparent: true, opacity: 0.08 + i * 0.015
    });
    const torus = new THREE.Mesh(geo, mat);
    torus.rotation.x = Math.PI * 0.32 + i * 0.13;
    torus.rotation.z = i * 0.22;
    torus.userData.speed = 0.02 + i * 0.005;
    torusGroup.add(torus);
  }
  scene.add(torusGroup);

  const startTime = performance.now();
  (function animate() {
    requestAnimationFrame(animate);
    const t = (performance.now() - startTime) * 0.001;
    torusGroup.rotation.y = t * 0.012;
    torusGroup.rotation.x = Math.sin(t * 0.008) * 0.06;
    torusGroup.children.forEach(c => { c.rotation.z += c.userData.speed * 0.003; });
    composer.render();
  })();

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
    composer.setSize(window.innerWidth, window.innerHeight);
  });
})();


// ==========================================================
//  AGENT CONSTELLATION ‚Äî Upgraded with bloom, labels,
//  energy beams, data flow, orbital rings, environment
// ==========================================================
(function initAgentConstellation() {
  const container = document.getElementById('agentViewport');
  if (!container) return;

  const w = container.clientWidth, h = container.clientHeight;
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(w, h);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.setClearColor(0x020406, 1);
  renderer.toneMapping = THREE.ACESFilmicToneMapping;
  renderer.toneMappingExposure = 1.1;
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFShadowMap;
  container.insertBefore(renderer.domElement, container.firstChild);

  const scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2(0x020406, 0.018);

  const camera = new THREE.PerspectiveCamera(50, w / h, 0.1, 200);
  camera.position.set(14, 9, 18);

  // Post-processing
  const composer = new EffectComposer(renderer);
  composer.addPass(new RenderPass(scene, camera));
  const bloom = new UnrealBloomPass(new THREE.Vector2(w, h), 0.75, 0.5, 0.35);
  composer.addPass(bloom);
  composer.addPass(new OutputPass());

  // OrbitControls
  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.05;
  controls.enablePan = false;
  controls.minDistance = 6;
  controls.maxDistance = 45;
  controls.maxPolarAngle = Math.PI * 0.85;
  controls.autoRotate = true;
  controls.autoRotateSpeed = 0.35;
  controls.target.set(0, 0, 0);

  // === LIGHTING ===
  scene.add(new THREE.AmbientLight(0x0d1526, 0.4));

  const keyLight = new THREE.DirectionalLight(0x00ffa3, 1.4);
  keyLight.position.set(10, 14, 8);
  keyLight.castShadow = true;
  keyLight.shadow.mapSize.set(2048, 2048);
  keyLight.shadow.camera.near = 1; keyLight.shadow.camera.far = 50;
  keyLight.shadow.camera.left = -15; keyLight.shadow.camera.right = 15;
  keyLight.shadow.camera.top = 15; keyLight.shadow.camera.bottom = -15;
  keyLight.shadow.bias = -0.001;
  scene.add(keyLight);

  const fillLight = new THREE.DirectionalLight(0x00d4ff, 0.35);
  fillLight.position.set(-8, 5, -10);
  scene.add(fillLight);

  const rimLight = new THREE.PointLight(0xc084fc, 2.0, 35, 1.5);
  rimLight.position.set(0, -6, 12);
  scene.add(rimLight);

  // Spotlight from above for dramatic cone
  const spot = new THREE.SpotLight(0x00ffa3, 3.0, 30, Math.PI * 0.18, 0.6, 1.2);
  spot.position.set(0, 15, 0);
  spot.target.position.set(0, 0, 0);
  spot.castShadow = true;
  spot.shadow.mapSize.set(1024, 1024);
  scene.add(spot);
  scene.add(spot.target);

  const coreLight = new THREE.PointLight(0x00ffa3, 3.0, 22, 1.5);
  coreLight.position.set(0, 0, 0);
  scene.add(coreLight);

  const coreLightCyan = new THREE.PointLight(0x00d4ff, 1.5, 18, 1.5);
  coreLightCyan.position.set(0, 0, 0);
  scene.add(coreLightCyan);

  // === GROUND ‚Äî Reflective dark plane ===
  const groundGeo = new THREE.PlaneGeometry(80, 80);
  const groundMat = new THREE.MeshPhysicalMaterial({
    color: 0x040810,
    metalness: 0.95,
    roughness: 0.15,
    transparent: true,
    opacity: 0.5,
    reflectivity: 0.9,
    clearcoat: 1.0,
    clearcoatRoughness: 0.1,
  });
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI / 2;
  ground.position.y = -6.5;
  ground.receiveShadow = true;
  scene.add(ground);

  // Hex grid on ground (instanced)
  const hexShape = new THREE.CircleGeometry(0.42, 6);
  const hexEdge = new THREE.EdgesGeometry(hexShape);
  const hexLineMat = new THREE.LineBasicMaterial({ color: 0x0a1a30, transparent: true, opacity: 0.5 });
  const hexSpacing = 1.0;
  for (let gx = -18; gx <= 18; gx++) {
    for (let gz = -18; gz <= 18; gz++) {
      const x = gx * hexSpacing * 0.866;
      const z = gz * hexSpacing + (gx % 2 ? hexSpacing * 0.5 : 0);
      if (x*x + z*z > 320) continue;
      const line = new THREE.LineSegments(hexEdge, hexLineMat);
      line.rotation.x = -Math.PI / 2;
      line.position.set(x, -6.48, z);
      scene.add(line);
    }
  }

  // === AGENT DEFINITIONS ===
  const agentDefs = [
    { name: 'smolagents CORE', label: 'smolagents', color: 0x00ffa3, emissive: 0x00ffa3, pos: [0, 0, 0], size: 1.1, type: 'core' },
    { name: 'Organization', label: 'ORG', color: 0x3b82f6, emissive: 0x1e40af, pos: [0, 4.5, 0], size: 0.65, type: 'agent' },
    { name: 'Market', label: 'MKT', color: 0xff6b35, emissive: 0xc2410c, pos: [-4.5, 1.5, 2.5], size: 0.55, type: 'agent' },
    { name: 'Vision', label: 'VIS', color: 0xc084fc, emissive: 0x7c3aed, pos: [4.5, 1.5, -2], size: 0.55, type: 'agent' },
    { name: 'Summary', label: 'SUM', color: 0x10b981, emissive: 0x059669, pos: [-3.5, -1.5, -3.5], size: 0.55, type: 'agent' },
    { name: 'Publication', label: 'PUB', color: 0x06b6d4, emissive: 0x0891b2, pos: [3.5, -1.5, 3.5], size: 0.55, type: 'agent' },
    { name: 'Performance', label: 'PERF', color: 0xf43f5e, emissive: 0xbe123c, pos: [0, -4, 0], size: 0.6, type: 'agent' },
    { name: 'Grok', label: 'GROK', color: 0x3b82f6, emissive: 0x1d4ed8, pos: [-7, -3, -1.5], size: 0.38, type: 'model' },
    { name: 'GPT', label: 'GPT', color: 0x10b981, emissive: 0x059669, pos: [-5, -4.5, 1.5], size: 0.38, type: 'model' },
    { name: 'Gemini', label: 'GEM', color: 0xa78bfa, emissive: 0x7c3aed, pos: [5, -4.5, -1.5], size: 0.38, type: 'model' },
    { name: 'Claude', label: 'CLD', color: 0xe48c57, emissive: 0xc2410c, pos: [7, -3, 1.5], size: 0.38, type: 'model' },
    { name: 'Playwright', label: 'PW', color: 0x475569, emissive: 0x334155, pos: [-6, 3.5, -3], size: 0.4, type: 'tool' },
    { name: 'Three.js UI', label: '3JS', color: 0x475569, emissive: 0x334155, pos: [6, 3.5, 3], size: 0.4, type: 'tool' },
    { name: 'FastAPI Hub', label: 'API', color: 0x475569, emissive: 0x334155, pos: [0, 6, -3], size: 0.45, type: 'tool' },
  ];

  const meshes = [];
  const glowMeshes = [];
  const labels = [];

  agentDefs.forEach(a => {
    // Geometry varies by type
    const geo = a.type === 'core'
      ? new THREE.IcosahedronGeometry(a.size, 3)
      : a.type === 'model'
        ? new THREE.OctahedronGeometry(a.size, 2)
        : a.type === 'tool'
          ? new THREE.DodecahedronGeometry(a.size, 1)
          : new THREE.SphereGeometry(a.size, 48, 48);

    const mat = new THREE.MeshPhysicalMaterial({
      color: a.color,
      emissive: a.emissive,
      emissiveIntensity: a.type === 'core' ? 0.9 : 0.3,
      metalness: a.type === 'core' ? 0.95 : 0.5,
      roughness: a.type === 'core' ? 0.05 : 0.25,
      clearcoat: 1.0,
      clearcoatRoughness: 0.08,
      iridescence: a.type === 'core' ? 1.0 : 0.3,
      iridescenceIOR: 1.5,
      sheen: a.type !== 'tool' ? 1.0 : 0,
      sheenColor: new THREE.Color(a.color).multiplyScalar(0.5),
      sheenRoughness: 0.3,
      transparent: true,
      opacity: 0.94,
    });

    const mesh = new THREE.Mesh(geo, mat);
    mesh.position.set(...a.pos);
    mesh.castShadow = true;
    mesh.userData = { ...a, baseEmissive: a.type === 'core' ? 0.9 : 0.3, targetScale: 1 };
    scene.add(mesh);
    meshes.push(mesh);

    // Layered glow shells
    for (let s = 0; s < (a.type === 'core' ? 3 : 2); s++) {
      const scale = 1.3 + s * 0.35;
      const glowGeo = new THREE.SphereGeometry(a.size * scale, 16, 16);
      const glowMat = new THREE.MeshBasicMaterial({
        color: a.color,
        transparent: true,
        opacity: (a.type === 'core' ? 0.08 : 0.04) / (s + 1),
        blending: THREE.AdditiveBlending,
        depthWrite: false,
        side: THREE.BackSide
      });
      const g = new THREE.Mesh(glowGeo, glowMat);
      g.position.copy(mesh.position);
      scene.add(g);
      if (s === 0) glowMeshes.push(g);
    }

    // Text label sprite
    const colorStr = '#' + new THREE.Color(a.color).getHexString();
    const sprite = makeTextSprite(a.label, colorStr, 42);
    sprite.position.set(a.pos[0], a.pos[1] + a.size + 0.6, a.pos[2]);
    sprite.userData.baseY = a.pos[1] + a.size + 0.6;
    scene.add(sprite);
    labels.push(sprite);

    // Orbital ring for agents and core
    if (a.type === 'agent' || a.type === 'core') {
      const rr = a.size * (a.type === 'core' ? 1.9 : 1.4);
      const ringGeo = new THREE.TorusGeometry(rr, 0.018, 6, 80);
      const ringMat = new THREE.MeshBasicMaterial({ color: a.color, transparent: true, opacity: 0.4 });
      const ring = new THREE.Mesh(ringGeo, ringMat);
      ring.position.set(...a.pos);
      ring.userData = { isRing: true, basePos: [...a.pos], axis: Math.random() };
      scene.add(ring);
      meshes.push(ring);
    }

    // Second ring for core (perpendicular)
    if (a.type === 'core') {
      const r2Geo = new THREE.TorusGeometry(2.2, 0.015, 6, 80);
      const r2Mat = new THREE.MeshBasicMaterial({ color: 0x00d4ff, transparent: true, opacity: 0.3 });
      const r2 = new THREE.Mesh(r2Geo, r2Mat);
      r2.position.set(0, 0, 0);
      r2.userData = { isRing: true, basePos: [0, 0, 0], axis: 1.5 };
      scene.add(r2);
      meshes.push(r2);

      const r3Geo = new THREE.TorusGeometry(2.6, 0.012, 6, 80);
      const r3Mat = new THREE.MeshBasicMaterial({ color: 0xc084fc, transparent: true, opacity: 0.2 });
      const r3 = new THREE.Mesh(r3Geo, r3Mat);
      r3.position.set(0, 0, 0);
      r3.userData = { isRing: true, basePos: [0, 0, 0], axis: 3.0 };
      scene.add(r3);
      meshes.push(r3);
    }
  });

  // === ENERGY BEAM CONNECTIONS (TubeGeometry) ===
  const beamCurves = [];
  const center = new THREE.Vector3(0, 0, 0);
  agentDefs.forEach(a => {
    if (a.name.includes('CORE')) return;
    const end = new THREE.Vector3(...a.pos);
    const mid = center.clone().lerp(end, 0.5);
    mid.y += (a.type === 'agent' ? 0.8 : 0.4);
    const curve = new THREE.QuadraticBezierCurve3(center.clone(), mid, end);
    beamCurves.push({ curve, color: a.color, type: a.type });

    // Tube beam
    const tubeGeo = new THREE.TubeGeometry(curve, 40, a.type === 'model' ? 0.015 : 0.025, 6, false);
    const tubeMat = new THREE.MeshBasicMaterial({
      color: a.color, transparent: true,
      opacity: a.type === 'model' ? 0.12 : 0.2,
      blending: THREE.AdditiveBlending, depthWrite: false
    });
    scene.add(new THREE.Mesh(tubeGeo, tubeMat));
  });

  // === DATA FLOW PARTICLES along beams ===
  const flowParticles = [];
  const flowPerBeam = 4;
  beamCurves.forEach(bc => {
    for (let i = 0; i < flowPerBeam; i++) {
      const geo = new THREE.SphereGeometry(bc.type === 'model' ? 0.04 : 0.06, 8, 8);
      const mat = new THREE.MeshBasicMaterial({
        color: bc.color, transparent: true, opacity: 0.9,
        blending: THREE.AdditiveBlending, depthWrite: false
      });
      const dot = new THREE.Mesh(geo, mat);
      dot.userData = { curve: bc.curve, offset: i / flowPerBeam, speed: 0.15 + Math.random() * 0.1 };
      scene.add(dot);
      flowParticles.push(dot);

      // Trail glow
      const tgeo = new THREE.SphereGeometry(0.15, 6, 6);
      const tmat = new THREE.MeshBasicMaterial({ color: bc.color, transparent: true, opacity: 0.08, blending: THREE.AdditiveBlending, depthWrite: false });
      const trail = new THREE.Mesh(tgeo, tmat);
      dot.userData.trail = trail;
      scene.add(trail);
    }
  });

  // === AMBIENT DUST ===
  const dustCount = 800;
  const dustPos = new Float32Array(dustCount * 3);
  const dustCol = new Float32Array(dustCount * 3);
  const dustColors = [new THREE.Color(0x00ffa3), new THREE.Color(0x00d4ff), new THREE.Color(0xc084fc)];
  for (let i = 0; i < dustCount; i++) {
    dustPos[i*3]   = (Math.random() - 0.5) * 35;
    dustPos[i*3+1] = (Math.random() - 0.5) * 25;
    dustPos[i*3+2] = (Math.random() - 0.5) * 35;
    const c = dustColors[Math.floor(Math.random() * 3)];
    dustCol[i*3] = c.r; dustCol[i*3+1] = c.g; dustCol[i*3+2] = c.b;
  }
  const dustGeo = new THREE.BufferGeometry();
  dustGeo.setAttribute('position', new THREE.BufferAttribute(dustPos, 3));
  dustGeo.setAttribute('color', new THREE.BufferAttribute(dustCol, 3));
  const dustMat = new THREE.PointsMaterial({
    size: 0.05, vertexColors: true, transparent: true, opacity: 0.5,
    blending: THREE.AdditiveBlending, depthWrite: false, sizeAttenuation: true
  });
  scene.add(new THREE.Points(dustGeo, dustMat));

  // === RAYCASTER ===
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2(99, 99);
  const hoverInfo = document.getElementById('hoverInfo');
  let hoveredMesh = null;

  renderer.domElement.addEventListener('pointermove', e => {
    const rect = renderer.domElement.getBoundingClientRect();
    mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
    mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
  });

  renderer.domElement.addEventListener('pointerleave', () => { mouse.set(99, 99); });

  // === ANIMATION ===
  const startTime2 = performance.now();
  let lastFrame = startTime2;
  function animate() {
    requestAnimationFrame(animate);
    const now = performance.now();
    const t = (now - startTime2) * 0.001;
    const dt = (now - lastFrame) * 0.001;
    lastFrame = now;
    controls.update();

    // Node float + rotation
    meshes.forEach((m, i) => {
      if (m.userData.isRing) {
        const a = m.userData.axis || 0;
        m.rotation.x = t * 0.35 + a;
        m.rotation.z = t * 0.25 + a * 0.7;
        m.position.y = m.userData.basePos[1] + Math.sin(t * 0.6 + a) * 0.15;
        return;
      }
      if (!m.userData.pos) return;
      m.position.y = m.userData.pos[1] + Math.sin(t * 0.5 + i * 0.9) * 0.22;
      m.rotation.y = t * 0.12 + i;
      if (m.userData.type === 'core') {
        m.rotation.x = t * 0.18;
        m.rotation.z = t * 0.08;
      }
      // Smooth scale for hover
      const ts = m.userData.targetScale || 1;
      const cs = m.scale.x;
      const ns = cs + (ts - cs) * 0.08;
      m.scale.setScalar(ns);
    });

    // Sync glow + label positions
    glowMeshes.forEach((g, i) => {
      if (meshes[i]) g.position.y = meshes[i].position.y;
    });
    labels.forEach((s, i) => {
      if (meshes[i]) s.position.y = meshes[i].position.y + meshes[i].userData.size + 0.6;
    });

    // Pulse lights
    coreLight.intensity = 2.5 + Math.sin(t * 1.8) * 1.0;
    coreLightCyan.intensity = 1.2 + Math.cos(t * 2.2) * 0.6;
    spot.intensity = 2.5 + Math.sin(t * 0.8) * 0.8;

    // Data flow particles
    flowParticles.forEach(p => {
      const u = p.userData;
      u.offset = (u.offset + u.speed * 0.008) % 1;
      const pt = u.curve.getPoint(u.offset);
      p.position.copy(pt);
      if (u.trail) u.trail.position.copy(pt);
    });

    // Dust drift
    const dp = dustGeo.attributes.position.array;
    for (let i = 0; i < dustCount; i++) {
      dp[i*3+1] += Math.sin(t * 0.25 + i * 0.3) * 0.0015;
      dp[i*3]   += Math.cos(t * 0.15 + i * 0.5) * 0.0008;
    }
    dustGeo.attributes.position.needsUpdate = true;

    // Raycaster hover
    raycaster.setFromCamera(mouse, camera);
    const interactable = meshes.filter(m => m.userData.name && !m.userData.isRing);
    const hits = raycaster.intersectObjects(interactable);
    if (hits.length > 0) {
      const obj = hits[0].object;
      if (hoveredMesh !== obj) {
        // Unhover prev
        if (hoveredMesh && hoveredMesh.userData.baseEmissive !== undefined) {
          hoveredMesh.material.emissiveIntensity = hoveredMesh.userData.baseEmissive;
          hoveredMesh.userData.targetScale = 1;
        }
        hoveredMesh = obj;
        hoveredMesh.material.emissiveIntensity = 1.5;
        hoveredMesh.userData.targetScale = 1.25;
        renderer.domElement.style.cursor = 'pointer';
      }
      const d = obj.userData;
      const icon = d.type === 'core' ? '‚≠ê' : d.type === 'agent' ? 'üß†' : d.type === 'model' ? '‚òÅÔ∏è' : 'üîß';
      const typeLabel = d.type.toUpperCase();
      hoverInfo.textContent = `${icon} ${typeLabel} ‚Ä∫ ${d.name}`;
      hoverInfo.style.borderColor = '#' + new THREE.Color(d.color).getHexString();
    } else {
      if (hoveredMesh && hoveredMesh.userData.baseEmissive !== undefined) {
        hoveredMesh.material.emissiveIntensity = hoveredMesh.userData.baseEmissive;
        hoveredMesh.userData.targetScale = 1;
      }
      hoveredMesh = null;
      hoverInfo.textContent = 'HOVER NODES FOR INFO';
      hoverInfo.style.borderColor = 'rgba(0,255,163,0.15)';
      renderer.domElement.style.cursor = 'grab';
    }

    composer.render();
  }
  animate();

  // Resize
  const ro = new ResizeObserver(() => {
    const nw = container.clientWidth, nh = container.clientHeight;
    renderer.setSize(nw, nh);
    composer.setSize(nw, nh);
    camera.aspect = nw / nh;
    camera.updateProjectionMatrix();
  });
  ro.observe(container);
})();
</script>

<!-- NON-MODULE SCRIPTS -->
<script>
// Mermaid
mermaid.initialize({
  startOnLoad: true, theme: 'dark',
  themeVariables: {
    primaryColor: '#172033', primaryTextColor: '#d1d9e6', primaryBorderColor: '#243352',
    lineColor: '#3b5580', secondaryColor: '#111825', tertiaryColor: '#0c1018',
    fontFamily: 'Chakra Petch, sans-serif', fontSize: '13px',
    nodeBorder: '#00ffa3', mainBkg: '#172033', clusterBkg: '#0c1018', clusterBorder: '#1a2744'
  },
  flowchart: { curve: 'basis', padding: 15 }
});

// Font size
let fontLevel = 0;
function adjustFont(dir) {
  if (dir === 0) fontLevel = 0;
  else fontLevel = Math.max(-4, Math.min(6, fontLevel + dir));
  document.documentElement.style.setProperty('--font-size-base', (15 + fontLevel) + 'px');
}

// Sidebar
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('hidden');
  document.getElementById('mainContent').classList.toggle('expanded');
}

// Fullscreen
function toggleFullscreen() { document.body.classList.toggle('fullscreen'); }

// Nav
function navTo(el, id) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
  document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });
}

// AI toggle
function toggleAI(card) { card.classList.toggle('open'); }

// Search
const searchInput = document.getElementById('searchInput');
const searchCount = document.getElementById('searchCount');
searchInput.addEventListener('input', function() {
  const q = this.value.trim().toLowerCase();
  clearHighlights();
  if (q.length < 2) { searchCount.style.display = 'none'; return; }
  let count = highlightText(document.getElementById('mainContent'), q);
  searchCount.textContent = count + ' found';
  searchCount.style.display = count > 0 ? 'inline' : 'none';
  const first = document.querySelector('.search-match');
  if (first) first.scrollIntoView({ behavior: 'smooth', block: 'center' });
});
function highlightText(el, query) {
  let count = 0;
  const walk = document.createTreeWalker(el, NodeFilter.SHOW_TEXT);
  const matches = [];
  while (walk.nextNode()) {
    const node = walk.currentNode;
    if (node.parentElement.closest('.mermaid, .mermaid-wrap, script, style, .code')) continue;
    const idx = node.textContent.toLowerCase().indexOf(query);
    if (idx >= 0) matches.push({ node, idx, len: query.length });
  }
  for (let i = matches.length - 1; i >= 0; i--) {
    const { node, idx, len } = matches[i];
    const span = document.createElement('span');
    span.className = 'search-match';
    const range = document.createRange();
    range.setStart(node, idx);
    range.setEnd(node, idx + len);
    range.surroundContents(span);
    count++;
  }
  return count;
}
function clearHighlights() {
  document.querySelectorAll('.search-match').forEach(el => {
    const parent = el.parentNode;
    parent.replaceChild(document.createTextNode(el.textContent), el);
    parent.normalize();
  });
}
document.addEventListener('keydown', e => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'k') { e.preventDefault(); searchInput.focus(); }
  if (e.key === 'Escape') { searchInput.value = ''; clearHighlights(); searchCount.style.display = 'none'; }
});

// Score bars
const observer = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if (e.isIntersecting) e.target.querySelectorAll('.score-fill[data-w]').forEach(bar => {
      setTimeout(() => { bar.style.width = bar.dataset.w + '%'; }, 200);
    });
  });
}, { threshold: 0.2 });
document.querySelectorAll('.section').forEach(s => observer.observe(s));
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS Satellite Map</title>

    <!-- 1. Leaflet CSS: The stylesheet for the mapping library -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>

    <!-- 2. Esri Leaflet CSS: For additional styling if needed -->
    <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.3.3/dist/esri-leaflet-geocoder.css"
          xintegrity="sha512-IM3Hs+feyi40yZhDH6AFSYdsoS6iSSUQ++qnxNbfAxZ4/mbLEGIHCubutGFbmdV5OKysoACHIWIm8soDx2dAFg=="
          crossorigin="">

    <!-- 3. Custom CSS: To make the map fill the entire browser window -->
    <style>
        html, body, #map {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevents scrollbars */
        }
        /* Style for the loading/error messages */
        #map p {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: #555;
        }
    </style>
    
    <!-- Google Fonts for a cleaner look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100">

    <!-- This is the container where the map will be embedded -->
    <div id="map">
        <p>Attempting to locate you...</p>
    </div>

    <!-- 4. Leaflet JavaScript: The core mapping library -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>

    <!-- 5. Esri Leaflet JavaScript: Plugin for using Esri (satellite) basemaps -->
    <script src="https://unpkg.com/esri-leaflet@3.0.10/dist/esri-leaflet.js"></script>
    
    <!-- Main application logic -->
    <script>
        // Wait until the HTML document is fully loaded and parsed
        document.addEventListener('DOMContentLoaded', () => {
            const mapContainer = document.getElementById('map');

            // First, check if the browser supports the Geolocation API
            if (!navigator.geolocation) {
                mapContainer.innerHTML = '<p>Sorry, Geolocation is not supported by your browser.</p>';
                return;
            }

            // If supported, request the user's current position
            // The third argument provides options, like enabling high accuracy
            navigator.geolocation.getCurrentPosition(onSuccess, onError, {
                enableHighAccuracy: true,
                timeout: 10000, // 10 seconds
                maximumAge: 0
            });

            /**
             * Success callback function. This runs when the location is successfully found.
             * @param {GeolocationPosition} position - The object containing location data.
             */
            function onSuccess(position) {
                // Extract latitude and longitude from the position object
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
                
                // Clear the initial "locating..." message
                mapContainer.innerHTML = "";

                // Initialize the Leaflet map in our 'map' div
                // Set the initial view to the user's coordinates with a zoom level of 16
                const map = L.map('map').setView([latitude, longitude], 16);

                // Add the satellite imagery basemap layer from Esri
                L.esri.basemapLayer('Imagery').addTo(map);
                // You can also add labels on top of the imagery
                L.esri.basemapLayer('ImageryLabels').addTo(map);

                // Create a marker at the user's location
                const marker = L.marker([latitude, longitude]).addTo(map);

                // Add a popup to the marker that appears when clicked
                marker.bindPopup("<b>You are here!</b><br>This is your approximate location.").openPopup();
            }

            /**
             * Error callback function. This runs if there's a problem getting the location.
             * @param {GeolocationPositionError} err - The error object.
             */
            function onError(err) {
                let errorMessage = 'An unknown error occurred.';
                switch (err.code) {
                    case err.PERMISSION_DENIED:
                        errorMessage = 'Location access was denied. Please enable it in your browser settings to see the map.';
                        break;
                    case err.POSITION_UNAVAILABLE:
                        errorMessage = 'Location information is currently unavailable.';
                        break;
                    case err.TIMEOUT:
                        errorMessage = 'The request to get your location timed out.';
                        break;
                }
                mapContainer.innerHTML = `<p><strong>Error:</strong> ${errorMessage}</p>`;
            }
        });
    </script>

</body>
</html>

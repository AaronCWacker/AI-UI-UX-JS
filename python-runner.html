<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Runner</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>
    <style>
        body { font-family: monospace; padding: 20px; background: #f8fafc; }
        #output { white-space: pre-wrap; border: 1px solid #ddd; padding: 10px; margin-top: 10px; }
        #console { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Running Python App</h1>
    <p id="status">Loading Pyodide...</p>
    <div id="output"></div>
    <div id="console">
        <input id="input" type="text" placeholder="Enter Python commands here..." style="width: 100%; padding: 5px;">
        <button onclick="runInteractive()">Run</button>
    </div>

    <script>
        async function main() {
            const status = document.getElementById('status');
            const output = document.getElementById('output');
            const urlParams = new URLSearchParams(window.location.search);
            const file = urlParams.get('file');

            if (!file || !file.endsWith('.py')) {
                status.textContent = 'Error: No valid .py file specified.';
                return;
            }

            status.textContent = 'Initializing Pyodide...';
            let pyodide = await loadPyodide({
                indexURL: "https://cdn.jsdelivr.net/pyodide/v0.26.1/full/"
            });

            // Optional: Load common libraries (add more as needed)
            await pyodide.loadPackage(['micropip']);
            const micropip = pyodide.pyimport('micropip');
            // Example: await micropip.install('numpy'); // Uncomment for specific apps

            status.textContent = `Fetching and running ${file}...`;
            try {
                const response = await fetch(file);
                if (!response.ok) throw new Error('File not found');
                const code = await response.text();
                const result = await pyodide.runPythonAsync(code);
                output.textContent = result || 'Execution complete (check console for prints).';
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }

            status.textContent = 'Ready. Use the console below for interactive input.';
            window.pyodide = pyodide; // Expose for interactive use
        }

        function runInteractive() {
            const input = document.getElementById('input').value;
            const output = document.getElementById('output');
            try {
                const result = window.pyodide.runPython(input);
                output.textContent += `\n> ${input}\n${result}`;
            } catch (error) {
                output.textContent += `\nError: ${error}`;
            }
        }

        main();
    </script>
</body>
</html>

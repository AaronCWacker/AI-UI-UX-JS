<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üöó MIRROR DRIVE ‚Äî Clone Flock</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
html,body{margin:0;overflow:hidden;background:#000;font-family:monospace;color:#0ff}
#ui{position:fixed;top:10px;left:10px;background:rgba(0,0,0,.7);padding:10px;border:1px solid #0ff}
#touch{
 position:fixed;bottom:10px;left:50%;transform:translateX(-50%);
 display:grid;grid-template-columns:repeat(4,60px);gap:6px
}
.btn{
 width:60px;height:60px;
 border:1px solid #0ff;
 background:#111;color:#0ff;
 display:flex;align-items:center;justify-content:center;
 user-select:none
}
</style>
</head>
<body>

<div id="ui">
Cells: <span id="cells">0</span><br>
Clones: <span id="clones">0</span><br>
Camera: <span id="cam">3P</span>
</div>

<div id="touch">
<div class="btn" data-k="w">W</div>
<div class="btn" data-k="a">A</div>
<div class="btn" data-k="s">S</div>
<div class="btn" data-k="d">D</div>
<div class="btn" data-k=" ">‚ê£</div>
<div class="btn" data-k="c">C</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.128/build/three.min.js"></script>
<script>
/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ENGINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const scene=new THREE.Scene();
scene.fog=new THREE.Fog(0x000000,20,300);

const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,.1,1000);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0x404040));
const sun=new THREE.DirectionalLight(0xffffff,.8);
sun.position.set(10,20,10);
scene.add(sun);

const ground=new THREE.Mesh(
 new THREE.PlaneGeometry(1000,1000),
 new THREE.MeshStandardMaterial({color:0x111111})
);
ground.rotation.x=-Math.PI/2;
scene.add(ground);

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ INPUT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const keys={};
addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);
document.querySelectorAll(".btn").forEach(b=>{
 b.ontouchstart=()=>keys[b.dataset.k]=true;
 b.ontouchend=()=>keys[b.dataset.k]=false;
});

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ PLAYER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function carMesh(color){
 return new THREE.Mesh(
  new THREE.BoxGeometry(1,0.5,2),
  new THREE.MeshStandardMaterial({color})
 );
}

const player={
 mesh:carMesh(0x00ffff),
 vel:0,
 rot:0,
 brain:[],
 cells:0
};
scene.add(player.mesh);

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CLONES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const clones=[];

function spawnClone(){
 const c={
  mesh:carMesh(0xff00ff),
  vel:0,
  rot:0,
  brainIndex:0,
  cells:player.brain.length
 };
 c.mesh.position.copy(player.mesh.position).add(new THREE.Vector3(Math.random()*4,0,Math.random()*4));
 clones.push(c);
 scene.add(c.mesh);
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ FIRING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const bullets=[];
function fire(from){
 const b=new THREE.Mesh(
  new THREE.SphereGeometry(0.1,6,6),
  new THREE.MeshBasicMaterial({color:0xff0000})
 );
 b.position.copy(from.mesh.position);
 b.userData={dir:new THREE.Vector3(0,0,-1).applyEuler(from.mesh.rotation)};
 bullets.push(b);
 scene.add(b);
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CAMERA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
let firstPerson=false;
function updateCamera(){
 if(firstPerson){
  camera.position.copy(player.mesh.position).add(new THREE.Vector3(0,1,0));
  camera.rotation.copy(player.mesh.rotation);
 }else{
  camera.position.lerp(
   player.mesh.position.clone().add(new THREE.Vector3(0,5,10).applyEuler(player.mesh.rotation)),
   0.1
  );
  camera.lookAt(player.mesh.position);
 }
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LOOP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const clock=new THREE.Clock();

function animate(){
 requestAnimationFrame(animate);
 const dt=clock.getDelta();

 /* PLAYER INPUT */
 let throttle=0, steer=0, fireBtn=false;
 if(keys.w) throttle=1;
 if(keys.s) throttle=-1;
 if(keys.a) steer=1;
 if(keys.d) steer=-1;
 if(keys[" "]) fireBtn=true;
 if(keys.c){firstPerson=!firstPerson;keys.c=false;}

 player.vel+=throttle*dt*10;
 player.vel*=0.98;
 player.rot+=steer*dt*2;
 player.mesh.rotation.y=player.rot;
 player.mesh.translateZ(-player.vel*dt);

 if(fireBtn) fire(player);

 /* RECORD BRAIN CELL */
 const cell={throttle,steer,fire:fireBtn};
 player.brain.push(cell);
 player.cells=player.brain.length;
 if(player.brain.length%300===0) spawnClone();

 /* CLONES */
 clones.forEach(c=>{
  if(c.brainIndex<player.brain.length){
   const bc=player.brain[c.brainIndex++];
   c.vel+=bc.throttle*dt*10;
   c.rot+=bc.steer*dt*2;
   if(bc.fire) fire(c);
  }
  c.vel*=0.97;
  c.mesh.rotation.y=c.rot;
  c.mesh.translateZ(-c.vel*dt);
 });

 /* BULLETS */
 bullets.forEach(b=>{
  b.position.add(b.userData.dir.clone().multiplyScalar(40*dt));
 });

 updateCamera();

 cells.textContent=player.cells;
 clonesCount.textContent=clones.length;
 cam.textContent=firstPerson?"1P":"3P";

 renderer.render(scene,camera);
}

const clonesCount=document.getElementById("clones");
animate();

addEventListener("resize",()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>

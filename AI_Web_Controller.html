<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamlit Web Runner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Dark background */
            color: #d1d5db; /* Light gray text */
        }
        .log-table th, .log-table td {
            word-break: break-all;
        }
        .status-success {
            color: #22c55e; /* Green */
            font-weight: 500;
        }
        .status-error {
            color: #ef4444; /* Red */
            font-weight: 500;
        }
        .status-pending {
            color: #eab308; /* Yellow */
            font-weight: 500;
        }
        .card {
            background-color: #1f2937;
            border: 1px solid #374151;
        }
        .btn-primary {
            background-color: #3b82f6;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #4b5563;
            transition: background-color: 0.3s;
        }
        .btn-secondary:hover {
            background-color: #374151;
        }
        input[type="text"], textarea {
            background-color: #374151;
            border-color: #4b5563;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white">Remote Control & Web Runner</h1>
            <p class="text-lg text-gray-400 mt-2">Send requests to a remote endpoint and log the I/O.
            </p>
        </header>

        <!-- Configuration Section -->
        <div class="card p-6 rounded-lg shadow-lg mb-8">
            <h2 class="text-2xl font-semibold text-white mb-4">Configuration</h2>
            <div class="flex flex-col md:flex-row items-center gap-4">
                <label for="endpointUrl" class="font-medium text-white">Endpoint URL:</label>
                <input type="text" id="endpointUrl" class="flex-grow w-full p-2 rounded-md text-gray-200 focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="e.g., http://localhost:8501/api/run" value="https://huggingface.co/spaces/awacke1/GPT-4o-omni-text-audio-image-video/+/api/predict/">
                <button id="testConnectionBtn" class="btn-secondary text-white font-bold py-2 px-4 rounded-md w-full md:w-auto">Test Connection</button>
            </div>
             <div class="flex items-center mt-4">
                <input id="useCorsProxy" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 bg-gray-700 border-gray-600">
                <label for="useCorsProxy" class="ml-2 block text-sm text-gray-300">Use CORS Proxy</label>
                <p class="ml-4 text-xs text-gray-500">Enable this if you get a "Failed to fetch" error due to CORS policy when calling a remote URL.</p>
            </div>
            <p id="connectionStatus" class="text-sm mt-3 h-4"></p>
        </div>

        <!-- Controls Section -->
        <div class="card p-6 rounded-lg shadow-lg mb-8">
            <h2 class="text-2xl font-semibold text-white mb-4">Controls</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                <button data-command='{"action": "start_process", "params": {"id": 123}}' class="request-btn btn-primary text-white font-bold py-2 px-4 rounded-md">Start Process</button>
                <button data-command='{"action": "query_status"}' class="request-btn btn-primary text-white font-bold py-2 px-4 rounded-md">Query Status</button>
                <button data-command='{"action": "fetch_data", "source": "database_A"}' class="request-btn btn-primary text-white font-bold py-2 px-4 rounded-md">Fetch Data A</button>
                <button data-command='{"action": "stop_process", "force": true}' class="request-btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md">Stop Process</button>
            </div>
             <div class="mt-6">
                <h3 class="text-xl font-semibold text-white mb-3">Custom Request</h3>
                <textarea id="customRequest" class="w-full p-2 rounded-md bg-gray-700 border border-gray-600 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:outline-none" rows="4" placeholder='{ "action": "custom", "payload": { "key": "value" } }'></textarea>
                <button id="sendCustomBtn" class="mt-3 btn-primary text-white font-bold py-2 px-4 rounded-md">Send Custom Request</button>
            </div>
        </div>

        <!-- Logging Section -->
        <div class="card p-6 rounded-lg shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold text-white">Interaction Log</h2>
                <button id="clearLogBtn" class="btn-secondary text-white font-bold py-2 px-4 rounded-md">Clear Log</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-400 log-table">
                    <thead class="text-xs text-gray-300 uppercase bg-gray-700">
                        <tr>
                            <th scope="col" class="px-6 py-3 rounded-l-lg">Timestamp</th>
                            <th scope="col" class="px-6 py-3">Input / Request</th>
                            <th scope="col" class="px-6 py-3">Output / Response</th>
                            <th scope="col" class="px-6 py-3">Duration</th>
                            <th scope="col" class="px-6 py-3 rounded-r-lg">Status</th>
                        </tr>
                    </thead>
                    <tbody id="logBody">
                        <!-- Log rows will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Modal container -->
    <div id="notificationModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="card p-6 rounded-lg shadow-lg max-w-sm w-full">
            <h3 id="modalTitle" class="text-xl font-semibold text-white mb-4">Notification</h3>
            <p id="modalMessage" class="text-gray-300 mb-6"></p>
            <button id="modalCloseBtn" class="btn-primary text-white font-bold py-2 px-4 rounded-md w-full">Close</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const endpointUrlInput = document.getElementById('endpointUrl');
            const testConnectionBtn = document.getElementById('testConnectionBtn');
            const connectionStatus = document.getElementById('connectionStatus');
            const requestButtons = document.querySelectorAll('.request-btn');
            const logBody = document.getElementById('logBody');
            const clearLogBtn = document.getElementById('clearLogBtn');
            const customRequestTextarea = document.getElementById('customRequest');
            const sendCustomBtn = document.getElementById('sendCustomBtn');
            const useCorsProxyCheckbox = document.getElementById('useCorsProxy');

            // Modal elements
            const notificationModal = document.getElementById('notificationModal');
            const modalMessage = document.getElementById('modalMessage');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            
            const PROXY_URL = 'https://corsproxy.io/?';

            // --- Modal Functions ---
            function showNotification(message) {
                modalMessage.textContent = message;
                notificationModal.classList.remove('hidden');
                notificationModal.classList.add('flex');
            }

            modalCloseBtn.addEventListener('click', () => {
                notificationModal.classList.add('hidden');
                notificationModal.classList.remove('flex');
            });


            // --- Event Listeners ---

            testConnectionBtn.addEventListener('click', testConnection);
            
            requestButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const commandString = button.getAttribute('data-command');
                    try {
                        const command = JSON.parse(commandString);
                        sendRequest(command);
                    } catch (e) {
                        console.error("Invalid command format in button's data-command attribute:", e);
                        logInteraction('Invalid Button Command', e.message, 'Error', 0);
                    }
                });
            });

            sendCustomBtn.addEventListener('click', () => {
                const commandString = customRequestTextarea.value;
                if (!commandString.trim()) {
                    showNotification('Custom request cannot be empty.');
                    return;
                }
                 try {
                    const command = JSON.parse(commandString);
                    sendRequest(command);
                } catch (e) {
                    showNotification('Invalid JSON in custom request.');
                    console.error('JSON Parse Error:', e);
                }
            });

            clearLogBtn.addEventListener('click', () => {
                logBody.innerHTML = '';
            });

            // --- Core Functions ---

            function logInteraction(request, response, status, duration) {
                const row = logBody.insertRow(0); // Insert at the top
                const timestamp = new Date();

                const formatJson = (data) => `<pre class="whitespace-pre-wrap">${JSON.stringify(data, null, 2)}</pre>`;
                const requestContent = typeof request === 'object' ? formatJson(request) : request;
                
                let responseContent;
                try {
                     responseContent = typeof response === 'object' ? formatJson(response) : response;
                } catch(e) {
                     responseContent = String(response);
                }
                
                let statusClass = '';
                if (status === 'Success') statusClass = 'status-success';
                else if (status === 'Error') statusClass = 'status-error';
                else if (status === 'Pending') statusClass = 'status-pending';

                row.innerHTML = `
                    <td class="px-6 py-4 align-top">${timestamp.toLocaleString()}</td>
                    <td class="px-6 py-4 align-top">${requestContent}</td>
                    <td class="px-6 py-4 align-top">${responseContent}</td>
                    <td class="px-6 py-4 align-top">${duration} ms</td>
                    <td class="px-6 py-4 align-top"><span class="${statusClass}">${status}</span></td>
                `;
            }

            function getUrl() {
                let url = endpointUrlInput.value;
                if(useCorsProxyCheckbox.checked) {
                    return `${PROXY_URL}${encodeURIComponent(url)}`;
                }
                return url;
            }

            async function sendRequest(command) {
                if (!endpointUrlInput.value) {
                    showNotification('Please set the endpoint URL first.');
                    return;
                }
                
                const url = getUrl();
                const startTime = Date.now();
                logInteraction(command, 'Sending request...', 'Pending', 0);

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(command),
                    });

                    const duration = Date.now() - startTime;
                    logBody.deleteRow(0); // Remove the "Pending" row

                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP error! Status: ${response.status} - ${errorText}`);
                    }

                    const responseData = await response.json();
                    logInteraction(command, responseData, 'Success', duration);

                } catch (error) {
                    const duration = Date.now() - startTime;
                    logBody.deleteRow(0); // Remove the "Pending" row
                    logInteraction(command, error.message, 'Error', duration);
                    console.error('Fetch Error:', error);
                }
            }
            
            async function testConnection() {
                const targetUrl = endpointUrlInput.value;
                if (!targetUrl) {
                    connectionStatus.textContent = 'Please enter a URL to test.';
                    connectionStatus.className = 'text-sm mt-3 h-4 text-yellow-400';
                    return;
                }
                
                const url = getUrl();
                connectionStatus.textContent = 'Testing...';
                connectionStatus.className = 'text-sm mt-3 h-4 text-yellow-400';
                
                try {
                    const response = await fetch(url, { method: 'OPTIONS' });
                     if (response.ok || response.type === 'opaque' || response.status === 405) {
                        connectionStatus.textContent = 'Connection successful!';
                        connectionStatus.className = 'text-sm mt-3 h-4 status-success';
                    } else {
                         throw new Error(`Test failed with status: ${response.status}`);
                    }
                } catch(e) {
                    connectionStatus.textContent = `Connection failed. Try enabling the CORS proxy.`;
                    connectionStatus.className = 'text-sm mt-3 h-4 status-error';
                    console.error('Connection Test Error:', e);
                }
            }

        });
    </script>

</body>
</html>

